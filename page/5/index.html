<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>KyleCe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="KyleCe">
<meta property="og:url" content="https://github.com/KyleCe/kylece.github.io/page/5/index.html">
<meta property="og:site_name" content="KyleCe">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="KyleCe">
  
    <link rel="alternate" href="/atom.xml" title="KyleCe" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/avatar.jpg">
  <link rel="apple-touch-icon" href="/css/images/avatar.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/home.css" >
  

  

  

  
  
  

</head>



  <body>


  
    <header id="header">

	<!-- 背景图模式 -->
	

    
      <div id="intrologo" class="intro-logo" style="background-position:center; background-repeat:no-repeat; background-image: url(); background-size: auto 100%;">

      <!-- Support rolling -->  
        
        <section class="awSlider">
          <div class="carousel slide carousel-fade " data-ride="carousel">

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
               
                  
                    <div class="item active">
                  
                    <img id="carousel-img0" src="/css/images/home-bg.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img0 = new Image();
                      var imageTag0 = document.getElementById("carousel-img0");
                      img0.src = imageTag0.src;
                      img0.onload=function(){
                        if (img0.width / img0.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag0.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag0.style.height = document.body.clientHeight + "px";
                          imageTag0.style.marginLeft = -(document.body.clientHeight * img0.width / img0.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img1" src="/css/images/sample.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img1 = new Image();
                      var imageTag1 = document.getElementById("carousel-img1");
                      img1.src = imageTag1.src;
                      img1.onload=function(){
                        if (img1.width / img1.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag1.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag1.style.height = document.body.clientHeight + "px";
                          imageTag1.style.marginLeft = -(document.body.clientHeight * img1.width / img1.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img2" src="https://source.unsplash.com/collection/954550/1920x1080">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img2 = new Image();
                      var imageTag2 = document.getElementById("carousel-img2");
                      img2.src = imageTag2.src;
                      img2.onload=function(){
                        if (img2.width / img2.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag2.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag2.style.height = document.body.clientHeight + "px";
                          imageTag2.style.marginLeft = -(document.body.clientHeight * img2.width / img2.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href=".carousel" role="button" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">Geri</span>
            </a>
            <a class="right carousel-control" href=".carousel" role="button" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">İleri</span>
            </a>
          </div>
        </section>
        <script>
          $('section.awSlider .carousel').carousel({
              pause: '',
              interval: 5000
          });
          var startImage = $('section.awSlider .item.active > img').attr('src');
          $('section.awSlider .carousel').on('slid.bs.carousel', function () {
              var bscn = $(this).find('.item.active > img').attr('src');
              $('section.awSlider > img').attr('src', bscn);
          });
        </script>
      

    
 


    <canvas width="100%" height="100%"></canvas>
    <script>
      var c = document.getElementsByTagName('canvas')[0],
          x = c.getContext('2d'),
          w = window.innerWidth,
          h = window.innerHeight,
          pr = window.devicePixelRatio || 1,
          f = 90,
          q,
          m = Math,
          r = 0,
          u = m.PI*2,
          v = m.cos,
          z = m.random
      c.width = w*pr
      c.height = h*pr
      x.scale(pr, pr)
      x.globalAlpha = 0.6

      <!-- 折线Polyline背景 -->
      
    </script>
    

    
      <div id="homelogo" class="homelogo" style="background: rgba(255,255,255,1);"> 
    

        
          <div class="homelogoback"  style="border: 1px solid #404040;" >
            <h1><a href="#content" id="logo">KyleCe</a></h1>
            <h3></h3>
            <h5>KyleCe</h5>
            <!-- <p><a href="https://github.com/iTimeTraveler" target="_blank">Github</a></p> -->
          </div>
        
    
    </div>
  </div>

  <!-- 自适应主页背景大图 -->
  

 <!-- home_logo_image居中 -->
 
    <script>
        var homelogodiv = document.getElementById("homelogo");
        if (document.all.homelogo.offsetWidth > document.body.clientWidth) {
          homelogodiv.style.width = document.body.clientWidth + "px";
          homelogodiv.style.marginLeft = document.body.clientWidth * -0.5 + "px";
        } else {
          homelogodiv.style.width = homelogodiv.clientWidth  + "px";
          homelogodiv.style.marginLeft = (homelogodiv.clientWidth)  * -0.5 + "px";
        }
    </script>
  

  <div class="intro-navigate">
      <p class="navigater-list">
        
          <a id="beautifont" class="main-nav-link" href="/">首页</a>
        
          <a id="beautifont" class="main-nav-link" href="/archives">归档</a>
        
          <a id="beautifont" class="main-nav-link" href="/categories">分类</a>
        
          <a id="beautifont" class="main-nav-link" href="/tags">标签</a>
        
          <a id="beautifont" class="main-nav-link" href="/about">关于</a>
        
      </p>
  </div>

</header>
  
  <div id="container">
    <div id="wrap">
      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;">
  
    <article id="post-技术/Android/retrofit2"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/retrofit2/">retrofit2</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/retrofit2/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<blockquote>
<p>作者： <a href="https://twitter.com/jakewharton" target="_blank" rel="noopener">Jake Wharton</a></p>
<p>原文引自：<a href="https://academy.realm.io/cn/posts/droidcon-jake-wharton-simple-http-retrofit-2/" target="_blank" rel="noopener">link</a></p>
</blockquote>
<p><a href="http://square.github.io/retrofit/" target="_blank" rel="noopener">Retrofit</a> 作为简化 HTTP 请求的库，已经运行多年，2.0版本依然不辱使命的在做这些事情。不过 2.0 版本修复了一些长期影响开发者的设计，还加入了前所未有的强大特性。在 NYC 2015 的这一个分享中，<a href="https://twitter.com/jakewharton" target="_blank" rel="noopener">Jake Wharton</a> 的演讲涵盖了所有 Retrofit 2.0 的新特性，全面介绍了 Retrofit 2.0 工作原理。</p>
<hr>
<hr>
<p><em>Save the date for Droidcon SF in March — a conference with best-in-class presentations from leaders in all parts of the Android ecosystem.</em></p>
<hr>
<h3 id="简介-0-00"><a href="#简介-0-00" class="headerlink" title="简介 (0:00);)"></a>简介 <a href="javascript:presentz.changeChapter(0,0,true" target="_blank" rel="noopener">(0:00)</a>;)</h3><p>我叫 <a href="https://twitter.com/jakewharton" target="_blank" rel="noopener">Jake Wharton</a>，现在在 <a href="https://squareup.com/" target="_blank" rel="noopener">Square</a> 工作。一个天真的人曾经说过：”Retrofit 2 将会在今年年底前放出。”，那个人，就是去年在纽约 DroidCon 上表态的我。然而，事实是 Retrofit 2 <strong>将会在今年年底放出</strong>，这次我保证！</p>
<p><a href="http://square.github.io/retrofit/" target="_blank" rel="noopener">Retrofit</a> 5年前就开源了，是 Square 最早的开源项目之一。一开始的时候，Retrofit 只是我们用在各个开源项目里的福袋：比如说最早里面有晃动检测功能，HTTP Client，还有现在的 tap 库。多数功能都是 Bob Lee 完成的，我大概 3 年前开始接管这些工作。最终历经 3 年，完成了 1.0 版本，然后彻底开源。从那会儿到现在，已经 release 了 18 个版本了。</p>
<h3 id="Retrofit-1-不错的地方-2-23"><a href="#Retrofit-1-不错的地方-2-23" class="headerlink" title="Retrofit 1 不错的地方 (2:23);)"></a>Retrofit 1 不错的地方 <a href="javascript:presentz.changeChapter(0,11,true" target="_blank" rel="noopener">(2:23)</a>;)</h3><p>Retrofit 里已经有很多不错的特性了。Retrofit 可以利用接口，方法和注解参数（parameter annotations）来声明式定义一个请求应该如何被创建。比如说，下面是一个如何请求 GitHub API 的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  List&lt;Contributor&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Retrofit 背后的 HTTP client，以及序列化机制（JSON/XML 协议）都是可替换（pluggable）的，因此你可以选择合适自己的方案。Retrofit 最早出来的时候，只支持 Apache 的 HTTP client。在 1.0 放出前，我们增加了 URL connection，以及 OkHttp 的支持。如果你想要加入的其他的 HTTP client，都可以简单的加入。这个特性非常赞，让我们有能力去支持不同的自定义 client。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">builder.setClient(new UrlConnectionClient());</span><br><span class="line">builder.setClient(new ApacheClient());</span><br><span class="line">builder.setClient(new OkClient());</span><br><span class="line"></span><br><span class="line">builder.setClient(new CustomClient());</span><br></pre></td></tr></table></figure>
<p>序列化功能也是可替换的。默认是用的 GSON，你当然也可以用 Jackson 来替换掉。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  List&lt;Contributor&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">builder.setConverter(new GsonConverter());</span><br><span class="line">builder.setConverter(new JacksonConverter());</span><br></pre></td></tr></table></figure>
<p>如果你在用某些数据交换协议，比如 protocol buffer，Retrofit 也支持 Google 的 <a href="https://github.com/google/protobuf">protobuf</a>，也包括 XML 协议的转换（如果你自己不怕折腾）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  ContributorResponse repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">builder.setConverter(new ProtoConverter());</span><br><span class="line">builder.setConverter(new WireConverter());</span><br><span class="line"></span><br><span class="line">builder.setConverter(new SimpleXMLConverter());</span><br><span class="line"></span><br><span class="line">builder.setConverter(new CustomConverter());</span><br></pre></td></tr></table></figure>
<p>序列化部分跟 client 部分一样，都是可替换的。你如果想要引入或者实现自己的序列化组件，完全没有问题。</p>
<p>在发请求的实现上，你可以用的方法有很多，比如：同步发送请求——</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  List&lt;Contributor&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List&lt;Contributor&gt; contributors =</span><br><span class="line">    gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br></pre></td></tr></table></figure>
<p>——和异步发送，他们之间的区别就是异步发送要在最后一个参数上声明一个 callback 回调函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  void repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo,</span><br><span class="line">      Callback&lt;List&lt;Contributor&gt;&gt; cb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service.repoContributors(&quot;square&quot;, &quot;retrofit&quot;, new Callback&lt;List&lt;Contributor&gt;&gt;() &#123;</span><br><span class="line">  @Override void success(List&lt;Contributor&gt; contributors, Response response) &#123;</span><br><span class="line">    // ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override void failure(RetrofitError error) &#123;</span><br><span class="line">    // ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>——再到后来 1.0 后，我们还支持了 <a href="https://github.com/ReactiveX/RxJava">RxJava</a> ，被证明真的是个非常受欢迎的功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Observable&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;)</span><br><span class="line">    .subscribe(new Action1&lt;List&lt;Contributor&gt;&gt;() &#123;</span><br><span class="line">      @Override public void call(List&lt;Contributor&gt; contributors) &#123;</span><br><span class="line">        // ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Retrofit-1-不够好的地方-4-58"><a href="#Retrofit-1-不够好的地方-4-58" class="headerlink" title="Retrofit 1: 不够好的地方 (4:58);)"></a>Retrofit 1: 不够好的地方 <a href="javascript:presentz.changeChapter(0,28,true" target="_blank" rel="noopener">(4:58)</a>;)</h3><p>不幸的是，没有一个库是完美的，Retrofit 也不例外。为了支持可替换的功能模块，我们必须嵌套大量的组件，类的数量极多以至于成为了一个痛处，一方面是因为整个库非常的脆弱，还有就是因为我们无法修改公开的 API 接口。</p>
<p>Receive news and updates from Realm straight to your inbox</p>
<p>订阅Comments</p>
<p>如果你想要操作某次请求返回的数据，比如说返回的 Header 部分或者 URL，你又同时想要操作序列化后的数据部分，这是 Retrofit 1.0 上是不可能实现的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  List&lt;Contributor&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Response repoContributors2(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的这个 GitHub 的例子里，我们返回了一个 contributor 的列表，你可以用不同的 converter 去做反序列化。然而，如果说你要读取一个 reponse 的 header 部分。除非你设置一个 endpoint 来接管这个 reponse，不然你没有办法去读取这个 response。 由于 response header 数据里并没有反序列化后的对象，如果不做反序列化操作的话，那你也就无法拿到 contributor 对象了。</p>
<p>我刚才说过同步和异步，以及用起来非常棒的 RxJava，但是这些用起来却有些刻板。比如：我们在某些场景下既需要异步的调用，又需要同步的调用。在 Retrofit 1.0 里，你必须得声明两次这个方法，像下面这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  List&lt;Contributor&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  void repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo,</span><br><span class="line">      Callback&lt;List&lt;Contributor&gt;&gt; cb);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>RxJava 也有类似问题。但值得庆幸的是你在用 RxJava 的时候只用声明一次就行，为了实现这个，我们还在核心代码里增加了对 RxJava 的支持，以辅助返回 Observable 的对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Observable&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可能已经熟悉如何在 Retrofit 里创建 Observable 对象。但是如果你需要一些其他对象呢？ 比如，我们没有计划支持用了 Guava 的 ListenableFuture，以及那些用了 Java 8 的 CompleteableFuture。毕竟，Retrofit 1 是基于还在用着 Java 6 的 Android 开发的。</p>
<p>Retrofit 1 里 Converter 工作的效率并不算是很高。下面是在 Retrofit 1 里创建自定义 Converter 的代码，非常简单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface Converter &#123;</span><br><span class="line">  Object fromBody(TypedInput body, Type type);</span><br><span class="line">  TypedOutput toBody(Object object);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义 Converter 接收一个对象，然后返回一个格式化后的 HTTP 对象。问题是在我们传入了 Response 和一个我们想要转换的格式 Type 参数后，Converter 必须得搞清楚到底应该如何去反序列化，这部分的实现很复杂，而且耗时。尽管一些库做了对象的缓存，但依然效率很低。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/search/repositories&quot;)</span><br><span class="line">  RepositoriesResponse searchRepos(</span><br><span class="line">      @Query(&quot;q&quot;) String query,</span><br><span class="line">      @Query(&quot;since&quot;) Date since);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/search/repositories?q=retrofit&amp;since=2015-08-27</span><br><span class="line">/search/repositories?q=retrofit&amp;since=20150827</span><br></pre></td></tr></table></figure>
<p>有时候，声明式 API 会遇到一些小问题。比如就像上面的例子一样，你有个接口需要传入一个 Date，但是一个 Date 会有多种不同的格式表示。有的接口可能需要一个字符串，有的可能需要一个分隔开的日期表示（尤其是那些比日期要复杂很多的对象，可能会有更多的表示方法）。</p>
<p>以上，基本上就是 Retrofit 1 无力解决的需求了，我们要如何修复呢？</p>
<h3 id="Retrofit-2-10-18"><a href="#Retrofit-2-10-18" class="headerlink" title="Retrofit 2 (10:18);)"></a>Retrofit 2 <a href="javascript:presentz.changeChapter(0,48,true" target="_blank" rel="noopener">(10:18)</a>;)</h3><p>开发 Retrofit2 的时候，我们希望我们定位和解决所有大家多年以来在 Retrofit 1 里遇到的那些问题。</p>
<h4 id="Call-10-30"><a href="#Call-10-30" class="headerlink" title="Call (10:30);)"></a>Call <a href="javascript:presentz.changeChapter(0,49,true" target="_blank" rel="noopener">(10:30)</a>;)</h4><p>首先得提到的是：Retrofit2 有了新的类型。如果你熟悉用 OkHttp 做 API 请求，你可能比较熟悉其中的一个类：<code>Call</code>。现在， Retrofit 2 里也多了一个 <code>call</code> 方法。语法和 OkHttp 基本一模一样，唯一不同是这个函数知道如何做数据的反序列化。它知道如何将 HTTP 响应转换成对象。</p>
<p>另外，每一个 call 对象实例只能被用一次，所以说 request 和 response 都是一一对应的。你其实可以通过 <code>Clone</code> 方法来创建一个一模一样的实例，这个开销是很小的。比如说：你可以在每次决定发请求前 <code>clone</code> 一个之前的实例。</p>
<p>另一个大的进步是 2.0 同时支持了在一个类型中的同步和异步。同时，一个请求也可以被<strong>真正地</strong>终止。终止操作会对底层的 http client 执行 cancel 操作。即便是正在执行的请求，也能立即切断。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Call&lt;List&lt;Contributor&gt;&gt; call =</span><br><span class="line">    gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br></pre></td></tr></table></figure>
<p>这个 Call 对象是从你的 API 接口返回的参数化后的对象。调用跟接口名相同的函数名，你就会得到一个实例出来。我们可以直接调用它的 execute 方法，但是得留意一下，这个方法只能调用一次。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Call&lt;List&lt;Contributor&gt;&gt; call =</span><br><span class="line">    gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br><span class="line"></span><br><span class="line">response = call.execute();</span><br><span class="line"></span><br><span class="line">// This will throw IllegalStateException:</span><br><span class="line">response = call.execute();</span><br><span class="line"></span><br><span class="line">Call&lt;List&lt;Contributor&gt;&gt; call2 = call.clone();</span><br><span class="line">// This will not throw:</span><br><span class="line">response = call2.execute();</span><br></pre></td></tr></table></figure>
<p>当你尝试调用第二次的时候，就会出现失败的错误。实际上，可以直接克隆一个实例，代价非常低。当你想要多次请求一个接口的时候，直接用 clone 的方法来生产一个新的，相同的可用对象吧。</p>
<p>想要实现异步，需要调用 <code>enqueue</code> 方法。现在，我们就能通过一次声明实现同步和异步了！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Call&lt;List&lt;Contributor&gt;&gt; call =</span><br><span class="line">    gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br><span class="line"></span><br><span class="line">call.enqueue(new Callback&lt;List&lt;Contributor&gt;&gt;() &#123;</span><br><span class="line">  @Override void onResponse(/* ... */) &#123;</span><br><span class="line">    // ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override void onFailure(Throwable t) &#123;</span><br><span class="line">    // ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当你将一些异步请求压入队列后，甚至你在执行同步请求的时候，你可以随时调用 <code>cancel</code> 方法来取消请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Call&lt;List&lt;Contributor&gt;&gt; call =</span><br><span class="line">    gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br><span class="line"></span><br><span class="line">call.enqueue(         );</span><br><span class="line">// or...</span><br><span class="line">call.execute();</span><br><span class="line"></span><br><span class="line">// later...</span><br><span class="line">call.cancel();</span><br></pre></td></tr></table></figure>
<h4 id="Parameterized-Response-Object-13-48"><a href="#Parameterized-Response-Object-13-48" class="headerlink" title="Parameterized Response Object (13:48);)"></a>Parameterized Response Object <a href="javascript:presentz.changeChapter(0,68,true" target="_blank" rel="noopener">(13:48)</a>;)</h4><p>另一个新的特性是参数化的 Response 类型。 Response 对象增加了曾经一直被我们忽略掉的重要元数据：响应码（the reponse code），响应消息（the response message），以及读取相应头（headers）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Response&lt;T&gt; &#123;</span><br><span class="line">  int code();</span><br><span class="line">  String message();</span><br><span class="line">  Headers headers();</span><br><span class="line"></span><br><span class="line">  boolean isSuccess();</span><br><span class="line">  T body();</span><br><span class="line">  ResponseBody errorBody();</span><br><span class="line">  com.squareup.okhttp.Response raw();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时还提供了一个很方便的函数来帮助你判断请求是否成功完成，其实就是检查了下响应码是不是 200。然后就拿到了响应的 body 部分，另外有一个单独的方法获取 error body。基本上就是出现一个返回码，然后调用相对应的函数的。只有当响应成功以后，我们会去做反序列化操作，然后将反序列化的结果放到 body 回调中去。如果出现了返回了网络成功响应（返回码：200）却最终返回 false 的情况，我们实际上是无法判断返回到底是什么的，只能将 <code>ResponseBody</code>（简单封装的了 content-type，length，以及 raw body部分） 类型交给你去处理。</p>
<p>以上是在声明接口时候的两个重大的改变。</p>
<h4 id="动态-URL-Parameter-16-33"><a href="#动态-URL-Parameter-16-33" class="headerlink" title="动态 URL Parameter (16:33);)"></a>动态 URL Parameter <a href="javascript:presentz.changeChapter(0,101,true" target="_blank" rel="noopener">(16:33)</a>;)</h4><p>动态 URL 参数是让我头疼多年的一个问题，现在我们终于解决了！如果你向 GitHub 发出多个请求，收到一个响应，通常这个响应大概像下面这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Call&lt;List&lt;Contributor&gt;&gt; call =</span><br><span class="line">    gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br><span class="line">Response&lt;List&lt;Contributor&gt;&gt; response = call.execute();</span><br><span class="line"></span><br><span class="line">// HTTP/1.1 200 OK</span><br><span class="line">// Link: &lt;https://api.github.com/repositories/892275/contributors?</span><br><span class="line">page=2&gt;; rel=&quot;next&quot;, &lt;https://api.github.com/repositories/892275/</span><br><span class="line">contributors?page=3&gt;; rel=&quot;last&quot;</span><br><span class="line">// ...</span><br></pre></td></tr></table></figure>
<p>要是你想做分页，你就得自己去分析这些 URL 了。GitHub 可能将 header link 地址列表里的数据已经缓存在服务器内存里了，当你去按他们指引的地址去请求的话，他们就不必费劲去从数据库里给你拿数据了，速度上也更快。但是，在 Retrofit 1.0 的时候，我们没有办法去直接执行 GitHub Server 返回在 header 里的请求地址。</p>
<p>用上我们新的 response 类型后，不止是我刚才提到的那些元数据，我们还可以写一些方法来读出自定义的字段，比如上面例子里的下一页的地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Response&lt;List&lt;Contributor&gt;&gt; response = call.execute();</span><br><span class="line"></span><br><span class="line">// HTTP/1.1 200 OK</span><br><span class="line">// Link: &lt;https://api.github.com/repositories/892275/contributors?</span><br><span class="line">page=2&gt;; rel=&quot;next&quot;, &lt;https://api.github.com/repositories/892275/</span><br><span class="line">contributors?page=3&gt;; rel=&quot;last&quot;</span><br><span class="line">// ...</span><br><span class="line"></span><br><span class="line">String links = response.headers().get(&quot;Link&quot;);</span><br><span class="line">String nextLink = nextFromGitHubLinks(links);</span><br><span class="line"></span><br><span class="line">// https://api.github.com/repositories/892275/contributors?page=2</span><br></pre></td></tr></table></figure>
<p>这个可能和上面的接口生成地址略有不同。</p>
<p>动态 URL 地址就是用在连续请求里的。在第一个请求之后，如果返回的结果里有指明下个请求的地址的话，在之前，你可能得单独写个 interface 来处理这种情况，现在就无需那么费事了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line"></span><br><span class="line">  @GET</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributorsPaginate(</span><br><span class="line">      @Url String url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Retrofit 2.0 有了新的 标注：<code>@Url</code> ，允许你直接传入一个请求的 URL。</p>
<p>有了这个方法后，我们就可以直接把刚才取出来的下一页的地址传入，是不是一切都流畅了很多：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String nextLink = nextFromGitHubLinks(links);</span><br><span class="line"></span><br><span class="line">// https://api.github.com/repositories/892275/contributors?page=2</span><br><span class="line"></span><br><span class="line">Call&lt;List&lt;Contributor&gt;&gt; nextCall =</span><br><span class="line">    gitHubService.repoContributorsPaginate(nextLink);</span><br></pre></td></tr></table></figure>
<p>这样的话，我们就能通过调用 <code>repoContributorsPaginate</code> 来获取第二页内容，然后通过第二页的 header 来请求第三页。你可能很多的 API 都见到过类似的设计，这在 Retrofit 1 里确实是个困扰很多人的大麻烦。</p>
<h4 id="更多更有效的-Converters-19-31"><a href="#更多更有效的-Converters-19-31" class="headerlink" title="更多更有效的 Converters (19:31);)"></a>更多更有效的 Converters <a href="javascript:presentz.changeChapter(0,113,true" target="_blank" rel="noopener">(19:31)</a>;)</h4><p>Retrofit 1 里有一个 converter 的问题。多数人可能没遇到过，是库内部的一个问题。在 Retrofit 2 里，我们已经解决了这个问题，同时开始支持多种 Converter 并存。</p>
<p>在之前，如果你遇到这种情况：一个 API 请求返回的结果需要通过 JSON 反序列化，另一个 API 请求需要通过 proto 反序列化，唯一的解决方案就是将两个接口分离开声明。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface SomeProtoService &#123;</span><br><span class="line">  @GET(&quot;/some/proto/endpoint&quot;)</span><br><span class="line">  Call&lt;SomeProtoResponse&gt; someProtoEndpoint();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface SomeJsonService &#123;</span><br><span class="line">  @GET(&quot;/some/json/endpoint&quot;)</span><br><span class="line">  Call&lt;SomeJsonResponse&gt; someJsonEndpoint();</span><br></pre></td></tr></table></figure>
<p>之所以搞得这么麻烦是因为一个 REST adapter 只能绑定一个 Converter 对象。我们费工夫去解决这个是因为：接口的声明是要语意化的。API 接口应该通过功能实现分组，比如： account 的接口，user 的接口，或者 Twitter 相关的接口。返回格式的差异不应该成为你分组时候的阻碍。</p>
<p>现在，你可以把他们都放在一起了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">interface SomeService &#123;</span><br><span class="line">  @GET(&quot;/some/proto/endpoint&quot;)</span><br><span class="line">  Call&lt;SomeProtoResponse&gt; someProtoEndpoint();</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/some/json/endpoint&quot;)</span><br><span class="line">  Call&lt;SomeJsonResponse&gt; someJsonEndpoint();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我大概提一下这个是怎么工作起来的，因为了解 Converter 的调用原理在写代码的时候很重要。</p>
<p>看我们上面的代码：第一个方法返回了一个 proto 对象。</p>
<p><code>SomeProtoResponse</code> —&gt; Proto? <strong>Yes!</strong></p>
<p>原理很简单，其实就是对着每一个 converter 询问他们是否能够处理某种类型。我们问 proto 的 converter： “Hi, 你能处理 <code>SomeProtoResponse</code> 吗？”，然后它尽可能的去判断它是否可以处理这种类型。我们都知道：Protobuff 都是从一个名叫 message 或者 message lite 的类继承而来。所以，判断方法通常就是检查这个类是否继承自 message。</p>
<p>在面对 JSON 类型的时候，首先问 proto converter，proto converter 会发现这个不是继承子 Message 的，然后回复 no。紧接着移到下一个 JSON converter 上。JSON Converter 会回复说我可以！</p>
<p><code>SomeJsonResponse</code> —&gt; Proto? <strong>No!</strong> —&gt; JSON? <strong>Yes!</strong></p>
<p>因为 JSON 并没有什么继承上的约束。所以我们无法通过什么确切的条件来判断一个对象是否是 JSON 对象。以至于 JSON 的 converters 会对任何数据都回复说：我可以处理！这个一定要记住， JSON converter 一定要放在最后，不然会和你的预期不符。</p>
<p>另一个要注意的是，现在已经不提供默认的 converter 了。如果不显性的声明一个可用的 Converter 的话，Retrofit 是会报错的：提醒你没有可用的 Converter。因为核心代码已经不依赖序列化相关的第三方库了，我们依然提供对 Converter 的支持，不过你需要自己引入这些依赖，同时显性的声明 Retrofit 需要用的 Converter 有哪些。</p>
<h4 id="更多可替换的执行机制-22-38"><a href="#更多可替换的执行机制-22-38" class="headerlink" title="更多可替换的执行机制 (22:38);)"></a>更多可替换的执行机制 <a href="javascript:presentz.changeChapter(0,121,true" target="_blank" rel="noopener">(22:38)</a>;)</h4><p>在此之前，Retrofit 有一个死板的 execution 流程。在 Retrofit 2 里，我们调整了整个流程，让它变得可替换（pluggable），同时允许多个。跟 converter 的工作原理很像。</p>
<p>比如说，你有一个方法返回了一个 Call 对象，Call 是内置的 Converter 类型。比如：Retrofit 2　的执行机制：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>现在，你可以自定义这些了。或者用我们提供的一个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Observable&lt;List&lt;Contributor&gt;&gt; repoContributors2(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Future&lt;List&lt;Contributor&gt;&gt; repoContributors3(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Retrofit 2.0 依然支持 RxJava，但现在是分离的。（你如果想要一些别的特性，你也可以自己写一个）同时支持不同的 execution 是怎么实现的呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(..);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Observable&lt;List&lt;Contributor&gt;&gt; repoContributors2(..);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Future&lt;List&lt;Contributor&gt;&gt; repoContributors3(..);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过返回类型来判断需要调用哪个 exection。比如说：返回为 Call 的类型， 我们的整个执行机制会问：“Hey，你知不知道如何处理 Call ？”　如果是 RxJava，它就会说：“我不知道，我只知道　Observable 的处理方法。”。　随后，我们又问内部的 converter，他刚好回答说：“是的！我会！”。</p>
<p><code>call</code> —&gt; RxJava? <strong>No!</strong> —&gt; Call? <strong>Yes!</strong></p>
<p>Observable 也是同样的工作原理。我们同样问 RxJava，它就说：“我能处理这个”：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(..);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Observable&lt;List&lt;Contributor&gt;&gt; repoContributors2(..);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Future&lt;List&lt;Contributor&gt;&gt; repoContributors3(..);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Observable —&gt; RxJava? <strong>Yes!</strong></p>
<p>如果你没装相对应的 Converter，这就意味着我们无法验证响应的类型。比如：如果询问是否有办法能处理　Future，他们两个都会说：“不行”。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(..);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Observable&lt;List&lt;Contributor&gt;&gt; repoContributors2(..);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Future&lt;List&lt;Contributor&gt;&gt; repoContributors3(..);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Future —&gt; RxJava? <strong>No!</strong> —&gt; Call? <strong>No!</strong> —&gt; Throw!</p>
<p>这将会返回一个 Exception，意味着这两个以及内置的机制都无法处理这种类型。关于工作原理我们随后会深入讨论。</p>
<h3 id="OkHttp-提供支持-24-17"><a href="#OkHttp-提供支持-24-17" class="headerlink" title="OkHttp 提供支持 (24:17);)."></a>OkHttp 提供支持 <a href="javascript:presentz.changeChapter(0,135,true" target="_blank" rel="noopener">(24:17)</a>;).</h3><p>Retrofit 2 现在开始依赖了 OkHttp 了，而且这部分不再支持替换。这是一件比较有争议的事情。但是希望我能证明为什么这是一个对的决定。</p>
<p>OkHttp 现在很小而且很聚焦，有很多好用的 API 接口。我们在 Retrofit 2 里都有对 OkHttp 的接口映射，也基本具备了我们需要的所有的特性，包括提到的所有的抽象类们。这些都超赞！这是压缩 Retrofit 库大小的一个法宝。我们最终减小了Retrofit 60% 的体积，同时又具有了更多的特性。</p>
<h3 id="OkHttp-提供支持-以及-Okio-26-20"><a href="#OkHttp-提供支持-以及-Okio-26-20" class="headerlink" title="OkHttp 提供支持 (以及 Okio!) (26:20);)"></a>OkHttp 提供支持 (以及 Okio!) <a href="javascript:presentz.changeChapter(0,141,true" target="_blank" rel="noopener">(26:20)</a>;)</h3><p>另一个用 OkHttp 的好处就是我们能够在 Retrofit 2 把 OkHttp 以公开接口的方式直接导出。你可能在 error body 方法或者响应里见到过 response body 的内容。显然，我们在 Retrofit 的 Reponse 对象里直接返回了 OkHttp 的 Response body。我们正在导出这些类型，OkHttp 的类型基本上已经以更好更简洁的 API 替代 Retrofit 1.0 的一些接口。</p>
<p>OkHttp 的背后是一个叫做 Okio 的库，提供的 IO 支持。我之前在 <a href="https://youtu.be/WvyScM_S88c" target="_blank" rel="noopener">Droidcon Montreal</a> 做过关于这个库的演讲。讨论过为什么它是众多 IO 库中更好的选择，还讨论了它为何极度高效，以及为什么你应该使用它们。演讲中我还提到 Retrofit 2 ，当时它还是脑海里的一个概念。现在 Retrofit 2 已经实现了。</p>
<h3 id="Retrofit-2-的效率-27-31"><a href="#Retrofit-2-的效率-27-31" class="headerlink" title="Retrofit 2 的效率 (27:31);)"></a>Retrofit 2 的效率 <a href="javascript:presentz.changeChapter(0,142,true" target="_blank" rel="noopener">(27:31)</a>;)</h3><p>我做了这个图表来展示 Retrofit 相比 Retrofit 1 以及其他可能的方案要高效的多，这归功于刚刚提到的硬性依赖和那些抽象。我带大家来看一下上面视频中的这个表。所以一定要看我演讲的这<a href="javascript:presentz.changeChapter(0,142,true" target="_blank" rel="noopener">部分</a>;)噢！</p>
<h3 id="初始化-Retrofit-类型-31-24"><a href="#初始化-Retrofit-类型-31-24" class="headerlink" title="初始化 - Retrofit 类型 (31:24);)"></a>初始化 - Retrofit 类型 <a href="javascript:presentz.changeChapter(0,164,true" target="_blank" rel="noopener">(31:24)</a>;)</h3><p>现在，让我们来看一下 Retrofit 的类型是如何替代 REST adapter 类型的，以及如何初始化。原来的方法叫做 <code>endpoint</code>, 不过现在我们称之为 <code>baseUrl</code>, <code>baseUrl</code> 就是你所请求的 Server 的 URL，下面是一个请求 GitHub Api 的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GitHubService gitHubService = retrofit.create(GitHubService.class);</span><br></pre></td></tr></table></figure>
<p>我们声明了自己的接口，我们称作创建方法，跟 Retrofit 1 里的是一致的。接下来，我们来生成一个接口的实现，以使这些接口方法可以直接被调用。</p>
<p>当我们调用 <code>repoContributors</code> 这个方法的时候，Retrofit 会创建这个 URL。如果我们传入 <code>Square</code> 和 <code>Retrofit</code> 字符串，分别作为 <code>owner</code> 和 <code>repo</code> 参数。我们就会得到这个 URL：<code>https://api.github.com/repos/square/retrofit/contributors</code>。在 Retrofit 内部，Retrofit 会用 OkHttp 的 HTTP URL 类型作为 基础的 URL ，然后 <code>resolve</code> 方法就会取出相对地址和 baseUrl 拼接起来，接着发起请求。接下来给你展示下改变 API 前缀，比如 V3。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com/v3/&quot;)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>虽然说这不是 GitHub 真实的 API，但是真实世界里就是有很多 API 是由这样的前缀和路径组成的。调用相同的方法，被解析出来的 URL 将会是是这样的： <code>https://api.github.com/repos/square/retrofit/contributors</code>。可以看到在主机地址之后并没有<code>v3</code> ，这是因为地址的 URL 是以一个斜线开始的，而在 HTTP 里，斜线开始的地址往往是绝对地址后缀路径。Retrofit 1 会因为语义化的约束，强制你加这个前缀斜线, 然后把 baseUrl 和相对地址拼接起来。现在，考虑到规范问题，我们已经对这两种地址加以区分。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果有前缀 <code>/</code> 就代表着是一个绝对路径。删除了那个前缀的 <code>/</code>， 你将会得到正确的、包含了 <code>v3</code> 路径的全 URL。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com/v3/&quot;)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// https://api.github.com/v3/repos/square/retrofit/contributors</span><br></pre></td></tr></table></figure>
<p>由于现在我们开始依赖 OkHttp， 并没有 Http Client 层的抽象。现在是可以传递一个配置好的 OkHttp 实例的。比如：配置 interceptors, 或者一个 SSL socket 工厂类， 或者 timeouts 的具体数值。 （OkHttp 有默认的超时机制，如果你不需要自定义，实际上不必进行任何设置，但是如果你想要去设置它们，下面是一个例子告诉你来怎么操作。）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient client = new OkHttpClient();</span><br><span class="line">client.interceptors().add(..);</span><br><span class="line"></span><br><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class="line">    .client(client)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<p>如果你要指明特定的 converter 或者 execute 机制，也是在这个时候加的。比如这会儿：我们可以给 GSON 设置一个或者多个 converter。也可以给 protocol buffer 设置一个 converter。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class="line">    .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">    .addConverterFactory(ProtoConverterFactory.create())</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<p>我想要强调的是：<strong>添加 converter 的顺序很重要</strong>。按照这个顺序，我们将依次询问每一个 converter 能否处理一个类型。我上面写的其实是错的。如果我们试图反序列化一个 proto 格式，它其实会被当做 JSON 来对待。这显然不是我们想要的。我们需要调整下顺序，因为我们先要检查 proto buffer 格式，然后才是 JSON。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class="line">    .addConverterFactory(ProtoConverterFactory.create())</span><br><span class="line">    .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<p>Retrofit 的文档里可能还没这些，如果你想要使用 RxJava 来代替 call, 你需要一个 Call Adapter Factory:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class="line">    .addConverterFactory(ProtoConverterFactory.create())</span><br><span class="line">    .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">    .addCallAdapterFactory(RxJavaCallAdapterFactory.create())</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<p>Call Adapter Factory 是一个知道如何将 call 实例转换成其他类型的工厂类。目前，我们只有 RxJava 的类型，也就是将 Call 类型转换成 Observable 类型。如果你了解 RxJava, 其实还有一种新的 Observable 类型（一次只发射一个 item 的类型）。你可以用这个 call adapter factory 来转换到其中任意一种 Observable。</p>
<h3 id="扩展性-36-50"><a href="#扩展性-36-50" class="headerlink" title="扩展性 (36:50);)"></a>扩展性 <a href="javascript:presentz.changeChapter(0,187,true" target="_blank" rel="noopener">(36:50)</a>;)</h3><p>刚才提到的 Factory，也是可扩展的。这意味着你可以写属于自己的 Call Adapter Facotry。实现起来其实就是一个方法。传递给它一个类型，返回 null 代表拒绝，或者返回一个 converter 的实例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SomeJsonResponse</span><br><span class="line"></span><br><span class="line">		class ProtoConverterFactory &#123;</span><br><span class="line">  			Converter&lt;?&gt; create(Type type);		null</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		class GsonConverterFactory &#123;</span><br><span class="line">			Converter&lt;?&gt; create(Type type);		Converter&lt;?&gt;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p>看上面的例子，如果你给它传递一个 JSON 的 Respnose 类型，这个类型不是从 proto 继承而来，那么它就会说：”我不知道如何传递这个，所以我返回空值 null.』，然而，对于 GSON converter 而言，它通过返回一个实例来表明它可以处理这个类型的。这就是为什么这个类是一个工厂类，因为我们让它生产 converter 实例。</p>
<p>如果你想要做一些自定义，实现起来是非常容易的。Converter 的实现与之前的实现是非常相似的，尽管代替类型化的输入和输出，我们现在使用的是 OkHttp 的请求body 和相应 body。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface Converter&lt;T&gt; &#123;</span><br><span class="line">  interface Factory &#123;</span><br><span class="line">	Converter &lt;?&gt; create(Type type);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  T fromBody(ResponseBody body);</span><br><span class="line">  RequestBody toBody(T value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在这已经高效的多，因为我们实际上可以查询那些 adapter。举个例子，GSON 有一个type adapter, 当我们请求 GSON Converter Factory，询问它是否可以处理某种请求的时候， converter factory 就开始查询这个 adapter, 它将以缓存的形式存在，当我们再次查询的时候，这个 adapter 就可以直接被使用了。这是一个非常小的成功，极力避免了不断地查询带来的损耗。</p>
<p>call adapter 有相同的模式。我们询问一个 call adapter factory 它是否可以处理某个类型，它将会以相同的方式回应。（例如：它会返回 null 来表达否）。它的API 是非常简单的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface CallAdapter&lt;T&gt; &#123;</span><br><span class="line">  interface Factory &#123;</span><br><span class="line">    CallAdapter&lt;?&gt; create(Type type);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Type responseType();</span><br><span class="line">  Object adapt(Call&lt;T&gt; value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们有一个方法来来实现适配。传入一个 call 实例，返回了一个 observable，single 或者 future 等。 还有一种方法来获得这种 response 类型：当我们声明一系列 contributor 调用时， 我们没法自动把那些参数化的类型提取出来，因此我们基本上只是请求这个 call adapter 也返回这个 response type。如果你为这个变量创造了一个实例，我们会请求 call adapter, 它会将 contributor type 列表返回。</p>
<h3 id="还在建设中-40-05"><a href="#还在建设中-40-05" class="headerlink" title="还在建设中 (40:05);)"></a>还在建设中 <a href="javascript:presentz.changeChapter(0,204,true" target="_blank" rel="noopener">(40:05)</a>;)</h3><p>Retrofit 2 正在完善中！现在还不够完整，但是已经可以用了。我上面提到的点都是已经完成了的，那还有哪些未完成呢？</p>
<p>关于所谓的“参数 handler”我们现在还没有一个成熟的想法。我们未来想要让它有从 Guava 传递多个 map，或者数据类型及枚举类型。</p>
<p>日志功能还没有完成，在 Retrofit 1 里是有日志的，但是在 Retrofit 2 里面没有。依赖 OkHttp 的一个优点是你实际上可以使用一个 interceptor 来实现实际的底层的请求和响应日志。因此，对于原始请求和响应，我们并不需要它，但是我们很可能需要日志来记录 Java 类型。</p>
<p>如果你曾经使用过 mock 模块，你会发现它也还没被完成，但很快会完成的。</p>
<p>现在文档依然比较缺。</p>
<p>最后，在我有空的时候，我想在 Retrofit 2 里支持 WebSocket。在 2.0 里很可能无法实现，但是我想在后续的2.1 版本里会加入支持。</p>
<h3 id="Release-41-31"><a href="#Release-41-31" class="headerlink" title="Release? (41:31);)"></a>Release? <a href="javascript:presentz.changeChapter(0,210,true" target="_blank" rel="noopener">(41:31)</a>;)</h3><p>我保证过 Retrofit 2 今年会和大家见面，今年确实可以。至于具体哪天问世，我们不会做任何承诺。我不想再在 2016 的 DroidCons 上开相同的玩笑。因此今年一定会问世。我保证。至于2015年8月27日，我已经开放了一个2.0的测试版。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  compile &apos;com.squareup.retrofit:retrofit:2.0.0-beta1&apos;</span><br><span class="line">  compile &apos;com.squareup.retrofit:converter-gson:2.0.0-beta1&apos;</span><br><span class="line">  compile &apos;com.squareup.retrofit:adapter-rxjava:2.0.0-beta1&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可以依赖它。它已经可以正常工作了，API 接口也相对稳定。Converter 和 converter 工厂方法未来可能会改变，但是总体来说是有用的。要是你有什么不喜欢或者有问题的地方，请联系我！谢谢！</p>

      

    </div>
    <footer class="article-footer">

      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/retrofit/">retrofit</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-技术/Android/【Android】AS-依赖lib建议、微信QRCode登陆"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/【Android】AS-依赖lib建议、微信QRCode登陆/">AndroidAS-依赖lib建议、微信QRCode登陆</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/【Android】AS-依赖lib建议、微信QRCode登陆/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>只有一条：<br>能download lib就download之后放到libs dir吧，不然伙伴们sync起来太费时间了；</p>
</blockquote>
<blockquote>
<p>这样的话，注意定期检查各lib版本就好</p>
</blockquote>
<p>今日入坑：微信登陆（扫描二维码登陆）<br><a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419317851&amp;token=&amp;lang=zh_CN" target="_blank" rel="noopener">参考链接：官方API doc</a></p>
<p>总结一下步骤：</p>
<ol>
<li>获取二维码（QRCode）</li>
<li>用户授权后，重定向接口会接受到带code的请求<code>--&gt;code [get]</code></li>
<li><p>拿着上一步的<code>code</code>，连带在微信注册时的appid、secret一起去请求access_token <code>--&gt;access_token、openid[get]</code></p>
</li>
<li><p><strong>大功告成</strong>：拿着上一步得到的token跟openid，就可以请求你想要的数据啦</p>
</li>
</ol>
<p>时序图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1481332-c7db4bd0ffa26d19.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="wechat.png"></p>
<hr>
<p>关注公众号“夕识”，雕刻时光，雕刻思维<br><img src="http://upload-images.jianshu.io/upload_images/1481332-c461a8ddbf8cf08e.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

      

    </div>
    <footer class="article-footer">

      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AndroidStudio/">AndroidStudio</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-技术/Android/【Android Tool】内存快照分析，自动抓取dump文件并转换脚本"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/【Android Tool】内存快照分析，自动抓取dump文件并转换脚本/">【Android Tool】内存快照分析，自动抓取dump文件并转换脚本</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/【Android Tool】内存快照分析，自动抓取dump文件并转换脚本/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>最新得到的Google内部消息，未来谷歌应用商店的排名算法将会把App的性能纳入考量范围（使用的机器学习算法），我们开发者也应该将性能这一指标纳入自己的检查范围</p>
</blockquote>
<h2 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h2><p>解决抓取内存文件，拉取到电脑，新建文件夹，转换为Eclipse Memory Analyzer 文件操作繁琐的问题</p>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ul>
<li>clone项目之后，上述流程只需要👇的指令即可完成</li>
<li>自动将转换的文件存档到新建的同名目录下，避免MAT分析产生的临时文件污染文档目录</li>
<li>更改目录或进程时，无需修改配置文件，输入即可自动记录上次操作习惯</li>
<li>重复输入名称时，会自动append 时间到原来名称，避免覆盖历史文件</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python GrabDump.py</span><br></pre></td></tr></table></figure>
<p>读完本文，你将收获到一个自动化上述流程的简单project</p>
<blockquote>
<p>需要了解 Apk包的内存占用各部分组成</p>
</blockquote>
<h3 id="GitHub-地址"><a href="#GitHub-地址" class="headerlink" title="GitHub 地址"></a>GitHub 地址</h3><p><a href="https://github.com/KyleCe/PhonePerformanceMeasure">https://github.com/KyleCe/PhonePerformanceMeasure</a></p>
<h2 id="关键点"><a href="#关键点" class="headerlink" title="关键点"></a>关键点</h2><p>最终的使用时样式：</p>
<p><img src="../../pic_resource/grabDump.png" alt=""></p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ul>
<li>首先你需要安装Python ^_^</li>
</ul>
<ul>
<li>可以输入的参数包括：  dump文件名、存放目录、需要抓取的进程名</li>
<li>下次输入时，如果没有完全输入，会自动使用上一次的参数</li>
</ul>
<blockquote>
<p>第一次输入的时候还是需要完全的配置</p>
</blockquote>
<h3 id="已知问题"><a href="#已知问题" class="headerlink" title="已知问题"></a>已知问题</h3><p>抓取dump次数过多时会出现adb缓存读写错误的问题，需要重启adb（kill-server | start-server），后续找到解决方案会及时更新到Github repository</p>
<hr>
<p>扫描二维码，关注“夕识”，一起学习Android知识、CS知识，努力成为一位  different thinker</p>
<p><img src="../../pic_resource/qrcode_for_wechat.jpg" alt=""></p>
<p>点击“链接”，跳转至repo地址</p>

      

    </div>
    <footer class="article-footer">

      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Dump/">Dump</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MemoryLeak/">MemoryLeak</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-技术/Android/GL Launcher memory consume test report"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/GL Launcher memory consume test report/">GL exampleModule memory consume test report</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/GL Launcher memory consume test report/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="“GL”-test部分模块-内存占用测试"><a href="#“GL”-test部分模块-内存占用测试" class="headerlink" title="“GL”  test部分模块 内存占用测试"></a>“GL”  test部分模块 内存占用测试</h1><blockquote>
<p>trunk 3.0 #90770</p>
<p>测试机型：N5 6.0</p>
</blockquote>
<h3 id="dump场景："><a href="#dump场景：" class="headerlink" title="dump场景："></a>dump场景：</h3><ol>
<li>正常运行——静置3min</li>
<li>进入负一屏</li>
<li>进入3D时钟</li>
<li>进入AllApps</li>
<li>进入天气</li>
<li>进入搜索</li>
<li>应用3D主题之后</li>
<li>3D主题关屏之后</li>
<li>从3D切回2D</li>
</ol>
<h2 id="测试结论"><a href="#测试结论" class="headerlink" title="测试结论"></a>测试结论</h2><blockquote>
<p>以下结论基于N5 6.0机型，结果未与其它机器、安卓版本做横向比较</p>
</blockquote>
<ul>
<li>test进程内，各模块切换时未出现太大波动</li>
<li>但test起始值（Gfx dev）在 40000KB（~40M）左右，考虑这一点是否有改进必要、空间？</li>
<li>3D主题相较2D，内存占用升高~17M左右（具体值未严格测试）</li>
<li>关屏之后（静置&gt;2min），未对内存占用做优化处理——考虑是否可行？是否必要？？？</li>
<li>从3D切回2D，内存反增11M左右（对此dump文件感兴趣的同学联系我）——此处需要分析hprof，找到问题点</li>
</ul>
<h2 id="实验数据"><a href="#实验数据" class="headerlink" title="实验数据"></a>实验数据</h2><h3 id="正常运行——静置3min"><a href="#正常运行——静置3min" class="headerlink" title="正常运行——静置3min"></a>正常运行——静置3min</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">16257</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">25108</span>    <span class="number">25080</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">43264</span>    <span class="number">36859</span>     <span class="number">6404</span></span><br><span class="line">  Dalvik Heap    <span class="number">42114</span>    <span class="number">42040</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">65438</span>    <span class="number">50717</span>    <span class="number">14721</span></span><br><span class="line"> Dalvik Other     <span class="number">3860</span>     <span class="number">3860</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1516</span>     <span class="number">1516</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">176</span>      <span class="number">140</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">41004</span>    <span class="number">41004</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev      <span class="number">136</span>        <span class="number">0</span>      <span class="number">136</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">8610</span>      <span class="number">320</span>      <span class="number">812</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">2555</span>        <span class="number">0</span>     <span class="number">2100</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">173</span>        <span class="number">0</span>      <span class="number">128</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">29908</span>       <span class="number">48</span>    <span class="number">23812</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">2767</span>        <span class="number">0</span>      <span class="number">900</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">1705</span>     <span class="number">1528</span>        <span class="number">4</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1078</span>        <span class="number">8</span>      <span class="number">608</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">44880</span>    <span class="number">44880</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">4924</span>     <span class="number">4924</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">210514</span>   <span class="number">165348</span>    <span class="number">28500</span>        <span class="number">0</span>   <span class="number">108702</span>    <span class="number">87576</span>    <span class="number">21125</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">43572</span></span><br><span class="line">         Native Heap:    <span class="number">25080</span></span><br><span class="line">                Code:    <span class="number">28120</span></span><br><span class="line">               Stack:     <span class="number">1516</span></span><br><span class="line">            Graphics:    <span class="number">85884</span></span><br><span class="line">       Private Other:     <span class="number">9676</span></span><br><span class="line">              System:    <span class="number">16666</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">210514</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="进入负一屏"><a href="#进入负一屏" class="headerlink" title="进入负一屏"></a>进入负一屏</h3><blockquote>
<p>未点击触发任何动画</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">16257</span> [com..test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">25583</span>    <span class="number">25548</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">43264</span>    <span class="number">37267</span>     <span class="number">5996</span></span><br><span class="line">  Dalvik Heap    <span class="number">45619</span>    <span class="number">45532</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">65017</span>    <span class="number">57890</span>     <span class="number">7127</span></span><br><span class="line"> Dalvik Other     <span class="number">3900</span>     <span class="number">3900</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1520</span>     <span class="number">1520</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">176</span>      <span class="number">140</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">42456</span>    <span class="number">42456</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev      <span class="number">136</span>        <span class="number">0</span>      <span class="number">136</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">9323</span>      <span class="number">320</span>      <span class="number">960</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">2583</span>        <span class="number">0</span>     <span class="number">2104</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">173</span>        <span class="number">0</span>      <span class="number">128</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">30308</span>       <span class="number">48</span>    <span class="number">24112</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">3297</span>        <span class="number">0</span>     <span class="number">1284</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">2015</span>     <span class="number">1540</span>      <span class="number">272</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1223</span>        <span class="number">8</span>      <span class="number">696</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">53520</span>    <span class="number">53520</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">4924</span>     <span class="number">4924</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">226756</span>   <span class="number">179456</span>    <span class="number">29692</span>        <span class="number">0</span>   <span class="number">108281</span>    <span class="number">95157</span>    <span class="number">13123</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">47344</span></span><br><span class="line">         Native Heap:    <span class="number">25548</span></span><br><span class="line">                Code:    <span class="number">28956</span></span><br><span class="line">               Stack:     <span class="number">1520</span></span><br><span class="line">            Graphics:    <span class="number">95976</span></span><br><span class="line">       Private Other:     <span class="number">9804</span></span><br><span class="line">              System:    <span class="number">17608</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">226756</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="进入3D时钟"><a href="#进入3D时钟" class="headerlink" title="进入3D时钟"></a>进入3D时钟</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">16257</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">25243</span>    <span class="number">25216</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">43776</span>    <span class="number">36699</span>     <span class="number">7076</span></span><br><span class="line">  Dalvik Heap    <span class="number">42553</span>    <span class="number">42480</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">66333</span>    <span class="number">50306</span>    <span class="number">16027</span></span><br><span class="line"> Dalvik Other     <span class="number">3692</span>     <span class="number">3692</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1532</span>     <span class="number">1532</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">176</span>      <span class="number">140</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">42884</span>    <span class="number">42884</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev      <span class="number">136</span>        <span class="number">0</span>      <span class="number">136</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">8622</span>      <span class="number">320</span>      <span class="number">836</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">2549</span>        <span class="number">0</span>     <span class="number">2108</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">173</span>        <span class="number">0</span>      <span class="number">128</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">29687</span>       <span class="number">48</span>    <span class="number">23884</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">3646</span>        <span class="number">0</span>     <span class="number">1660</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">2539</span>     <span class="number">1564</span>      <span class="number">792</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1077</span>        <span class="number">8</span>      <span class="number">608</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">36240</span>    <span class="number">36240</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">4924</span>     <span class="number">4924</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">205673</span>   <span class="number">159048</span>    <span class="number">30152</span>        <span class="number">0</span>   <span class="number">110109</span>    <span class="number">87005</span>    <span class="number">23103</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">44836</span></span><br><span class="line">         Native Heap:    <span class="number">25216</span></span><br><span class="line">                Code:    <span class="number">28984</span></span><br><span class="line">               Stack:     <span class="number">1532</span></span><br><span class="line">            Graphics:    <span class="number">79124</span></span><br><span class="line">       Private Other:     <span class="number">9508</span></span><br><span class="line">              System:    <span class="number">16473</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">205673</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="进入AllApps"><a href="#进入AllApps" class="headerlink" title="进入AllApps"></a>进入AllApps</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">16257</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">25539</span>    <span class="number">25512</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">43776</span>    <span class="number">37873</span>     <span class="number">5902</span></span><br><span class="line">  Dalvik Heap    <span class="number">45413</span>    <span class="number">45340</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">66146</span>    <span class="number">57815</span>     <span class="number">8331</span></span><br><span class="line"> Dalvik Other     <span class="number">3960</span>     <span class="number">3960</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1532</span>     <span class="number">1532</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">176</span>      <span class="number">140</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">39380</span>    <span class="number">39380</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev      <span class="number">136</span>        <span class="number">0</span>      <span class="number">136</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">8620</span>      <span class="number">320</span>      <span class="number">836</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">2549</span>        <span class="number">0</span>     <span class="number">2108</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">173</span>        <span class="number">0</span>      <span class="number">128</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">29887</span>       <span class="number">48</span>    <span class="number">24052</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">3646</span>        <span class="number">0</span>     <span class="number">1648</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">2558</span>     <span class="number">1584</span>      <span class="number">792</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1127</span>        <span class="number">8</span>      <span class="number">636</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">44880</span>    <span class="number">44880</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">4924</span>     <span class="number">4924</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">214500</span>   <span class="number">167628</span>    <span class="number">30336</span>        <span class="number">0</span>   <span class="number">109922</span>    <span class="number">95688</span>    <span class="number">14233</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">47716</span></span><br><span class="line">         Native Heap:    <span class="number">25512</span></span><br><span class="line">                Code:    <span class="number">29140</span></span><br><span class="line">               Stack:     <span class="number">1532</span></span><br><span class="line">            Graphics:    <span class="number">84260</span></span><br><span class="line">       Private Other:     <span class="number">9804</span></span><br><span class="line">              System:    <span class="number">16536</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">214500</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="进入天气"><a href="#进入天气" class="headerlink" title="进入天气"></a>进入天气</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">16257</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">30251</span>    <span class="number">30224</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">50176</span>    <span class="number">46472</span>     <span class="number">3703</span></span><br><span class="line">  Dalvik Heap    <span class="number">56889</span>    <span class="number">56816</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">82047</span>    <span class="number">68387</span>    <span class="number">13660</span></span><br><span class="line"> Dalvik Other     <span class="number">4124</span>     <span class="number">4124</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1872</span>     <span class="number">1872</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">228</span>      <span class="number">144</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">48684</span>    <span class="number">48684</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev      <span class="number">136</span>        <span class="number">0</span>      <span class="number">136</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">9119</span>      <span class="number">320</span>     <span class="number">1216</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">2537</span>        <span class="number">0</span>     <span class="number">2096</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">261</span>        <span class="number">0</span>      <span class="number">216</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">31424</span>       <span class="number">48</span>    <span class="number">25576</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">3819</span>        <span class="number">0</span>     <span class="number">1784</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">2593</span>     <span class="number">1620</span>      <span class="number">792</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1397</span>        <span class="number">8</span>      <span class="number">852</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">39552</span>    <span class="number">39552</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">9044</span>     <span class="number">9044</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">241930</span>   <span class="number">192456</span>    <span class="number">32668</span>        <span class="number">0</span>   <span class="number">132223</span>   <span class="number">114859</span>    <span class="number">17363</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">59228</span></span><br><span class="line">         Native Heap:    <span class="number">30224</span></span><br><span class="line">                Code:    <span class="number">31256</span></span><br><span class="line">               Stack:     <span class="number">1872</span></span><br><span class="line">            Graphics:    <span class="number">88236</span></span><br><span class="line">       Private Other:    <span class="number">14308</span></span><br><span class="line">              System:    <span class="number">16806</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">241930</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="进入搜索"><a href="#进入搜索" class="headerlink" title="进入搜索"></a>进入搜索</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">16257</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">30979</span>    <span class="number">30952</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">51712</span>    <span class="number">46697</span>     <span class="number">5014</span></span><br><span class="line">  Dalvik Heap    <span class="number">53559</span>    <span class="number">53488</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">78029</span>    <span class="number">62140</span>    <span class="number">15889</span></span><br><span class="line"> Dalvik Other     <span class="number">4084</span>     <span class="number">4084</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1864</span>     <span class="number">1864</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">224</span>      <span class="number">152</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">44948</span>    <span class="number">44948</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev      <span class="number">136</span>        <span class="number">0</span>      <span class="number">136</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">9092</span>      <span class="number">320</span>     <span class="number">1184</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">1214</span>        <span class="number">0</span>      <span class="number">812</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">224</span>        <span class="number">0</span>      <span class="number">204</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">31530</span>       <span class="number">48</span>    <span class="number">25696</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">4048</span>        <span class="number">0</span>     <span class="number">2056</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">2619</span>     <span class="number">1704</span>      <span class="number">732</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1449</span>        <span class="number">8</span>      <span class="number">812</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">53520</span>    <span class="number">53520</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">8700</span>     <span class="number">8700</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">248190</span>   <span class="number">199788</span>    <span class="number">31632</span>        <span class="number">0</span>   <span class="number">129741</span>   <span class="number">108837</span>    <span class="number">20903</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">55924</span></span><br><span class="line">         Native Heap:    <span class="number">30952</span></span><br><span class="line">                Code:    <span class="number">30320</span></span><br><span class="line">               Stack:     <span class="number">1864</span></span><br><span class="line">            Graphics:    <span class="number">98468</span></span><br><span class="line">       Private Other:    <span class="number">13892</span></span><br><span class="line">              System:    <span class="number">16770</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">248190</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="应用3D主题之后"><a href="#应用3D主题之后" class="headerlink" title="应用3D主题之后"></a>应用3D主题之后</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">23770</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">16450</span>    <span class="number">16424</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">24832</span>    <span class="number">22375</span>     <span class="number">2456</span></span><br><span class="line">  Dalvik Heap    <span class="number">32283</span>    <span class="number">32212</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">57652</span>    <span class="number">46603</span>    <span class="number">11049</span></span><br><span class="line"> Dalvik Other     <span class="number">3352</span>     <span class="number">3352</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack      <span class="number">864</span>      <span class="number">864</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">130</span>      <span class="number">128</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">58872</span>    <span class="number">58872</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev        <span class="number">4</span>        <span class="number">0</span>        <span class="number">4</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">3563</span>      <span class="number">268</span>     <span class="number">1692</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">1359</span>        <span class="number">0</span>      <span class="number">896</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">114</span>        <span class="number">0</span>      <span class="number">112</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">24990</span>       <span class="number">32</span>    <span class="number">20756</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">3203</span>        <span class="number">0</span>     <span class="number">1672</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">1352</span>     <span class="number">1152</span>       <span class="number">16</span>        <span class="number">0</span></span><br><span class="line">   Other mmap      <span class="number">913</span>        <span class="number">8</span>      <span class="number">716</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">44880</span>    <span class="number">44880</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown      <span class="number">300</span>      <span class="number">300</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">192629</span>   <span class="number">158492</span>    <span class="number">25864</span>        <span class="number">0</span>    <span class="number">82484</span>    <span class="number">68978</span>    <span class="number">13505</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">33380</span></span><br><span class="line">         Native Heap:    <span class="number">16424</span></span><br><span class="line">                Code:    <span class="number">25428</span></span><br><span class="line">               Stack:      <span class="number">864</span></span><br><span class="line">            Graphics:   <span class="number">103752</span></span><br><span class="line">       Private Other:     <span class="number">4508</span></span><br><span class="line">              System:     <span class="number">8273</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">192629</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="3D桌面——关屏"><a href="#3D桌面——关屏" class="headerlink" title="3D桌面——关屏"></a>3D桌面——关屏</h3><blockquote>
<p>静置1min</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">23770</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">20416</span>    <span class="number">20388</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">33280</span>    <span class="number">27504</span>     <span class="number">5775</span></span><br><span class="line">  Dalvik Heap    <span class="number">34972</span>    <span class="number">34900</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">60660</span>    <span class="number">44452</span>    <span class="number">16208</span></span><br><span class="line"> Dalvik Other     <span class="number">3228</span>     <span class="number">3228</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1088</span>     <span class="number">1088</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">150</span>      <span class="number">136</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">59148</span>    <span class="number">59148</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev        <span class="number">8</span>        <span class="number">0</span>        <span class="number">8</span>        <span class="number">0</span></span><br><span class="line">     .so mmap    <span class="number">12463</span>      <span class="number">284</span>     <span class="number">9176</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">2967</span>        <span class="number">0</span>     <span class="number">2524</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">110</span>        <span class="number">0</span>      <span class="number">108</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">31520</span>       <span class="number">52</span>    <span class="number">26864</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">3170</span>        <span class="number">0</span>     <span class="number">1560</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">1701</span>     <span class="number">1348</span>       <span class="number">20</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1359</span>        <span class="number">8</span>     <span class="number">1120</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">44880</span>    <span class="number">44880</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">3652</span>     <span class="number">3652</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">220832</span>   <span class="number">169112</span>    <span class="number">41380</span>        <span class="number">0</span>    <span class="number">93940</span>    <span class="number">71956</span>    <span class="number">21983</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">36268</span></span><br><span class="line">         Native Heap:    <span class="number">20388</span></span><br><span class="line">                Code:    <span class="number">40568</span></span><br><span class="line">               Stack:     <span class="number">1088</span></span><br><span class="line">            Graphics:   <span class="number">104028</span></span><br><span class="line">       Private Other:     <span class="number">8152</span></span><br><span class="line">              System:    <span class="number">10340</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">220832</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="从3D切回2D"><a href="#从3D切回2D" class="headerlink" title="从3D切回2D"></a>从3D切回2D</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">23770</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">23624</span>    <span class="number">23596</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">37376</span>    <span class="number">31068</span>     <span class="number">6307</span></span><br><span class="line">  Dalvik Heap    <span class="number">48127</span>    <span class="number">48056</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">69274</span>    <span class="number">53190</span>    <span class="number">16084</span></span><br><span class="line"> Dalvik Other     <span class="number">3368</span>     <span class="number">3368</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1256</span>     <span class="number">1256</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">150</span>      <span class="number">136</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">70896</span>    <span class="number">70896</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev        <span class="number">8</span>        <span class="number">0</span>        <span class="number">8</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">4425</span>      <span class="number">320</span>      <span class="number">968</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap      <span class="number">654</span>        <span class="number">0</span>       <span class="number">64</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">118</span>        <span class="number">0</span>      <span class="number">108</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">13328</span>       <span class="number">52</span>     <span class="number">8816</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">1996</span>        <span class="number">0</span>      <span class="number">380</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">2020</span>     <span class="number">1440</span>      <span class="number">332</span>        <span class="number">0</span></span><br><span class="line">   Other mmap       <span class="number">88</span>        <span class="number">8</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">53520</span>    <span class="number">53520</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">3668</span>     <span class="number">3668</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">227246</span>   <span class="number">206316</span>    <span class="number">10676</span>        <span class="number">0</span>   <span class="number">106650</span>    <span class="number">84258</span>    <span class="number">22391</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">49828</span></span><br><span class="line">         Native Heap:    <span class="number">23596</span></span><br><span class="line">                Code:    <span class="number">10708</span></span><br><span class="line">               Stack:     <span class="number">1256</span></span><br><span class="line">            Graphics:   <span class="number">124416</span></span><br><span class="line">       Private Other:     <span class="number">7188</span></span><br><span class="line">              System:    <span class="number">10254</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">227246</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">------------------------              </span></span><br><span class="line"><span class="function">After 5Min------------------              </span></span><br><span class="line"><span class="function">------------------------              </span></span><br><span class="line"><span class="function">** MEMINFO in pid 23770 [com.org.test] **</span></span><br><span class="line"><span class="function">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span></span><br><span class="line"><span class="function">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span></span><br><span class="line"><span class="function">                ------   ------   ------   ------   ------   ------   ------</span></span><br><span class="line"><span class="function">  Native Heap    23368    23340        0        0    37120    30598     6521</span></span><br><span class="line"><span class="function">  Dalvik Heap    43928    43856        0        0    69379    65551     3828</span></span><br><span class="line"><span class="function"> Dalvik Other     3560     3560        0        0</span></span><br><span class="line"><span class="function">        Stack     1244     1244        0        0</span></span><br><span class="line"><span class="function">       Ashmem      150      136        0        0</span></span><br><span class="line"><span class="function">      Gfx dev    72440    72440        0        0</span></span><br><span class="line"><span class="function">    Other dev        8        0        8        0</span></span><br><span class="line"><span class="function">     .so mmap     3636      320      788        0</span></span><br><span class="line"><span class="function">    .apk mmap      395        0        0        0</span></span><br><span class="line"><span class="function">    .ttf mmap       26        0        8        0</span></span><br><span class="line"><span class="function">    .dex mmap    12470       52     8176        0</span></span><br><span class="line"><span class="function">    .oat mmap     2610        0      260        0</span></span><br><span class="line"><span class="function">    .art mmap     2159     1456       28        0</span></span><br><span class="line"><span class="function">   Other mmap       58        8       20        0</span></span><br><span class="line"><span class="function">   EGL mtrack    44880    44880        0        0</span></span><br><span class="line"><span class="function">      Unknown     3668     3668        0        0</span></span><br><span class="line"><span class="function">        TOTAL   214600   194960     9288        0   106499    96149    10349</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> App Summary</span></span><br><span class="line"><span class="function">                       <span class="title">Pss</span><span class="params">(KB)</span></span></span><br><span class="line"><span class="function">                        ------</span></span><br><span class="line"><span class="function">           Java Heap:    45340</span></span><br><span class="line"><span class="function">         Native Heap:    23340</span></span><br><span class="line"><span class="function">                Code:     9604</span></span><br><span class="line"><span class="function">               Stack:     1244</span></span><br><span class="line"><span class="function">            Graphics:   117320</span></span><br><span class="line"><span class="function">       Private Other:     7400</span></span><br><span class="line"><span class="function">              System:    10352</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">               TOTAL:   214600      TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>

      

    </div>
    <footer class="article-footer">

      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GL/">GL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Performance/">Performance</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-技术/【Note】《构建之法》提要"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/【Note】《构建之法》提要/">【Note】《构建之法》提要</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/【Note】《构建之法》提要/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/阅读/">阅读</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>《软件工程  构建之法》作者邹欣系Windows中国工程师团队首席研发总监 （Link：<a href="https://www.amazon.cn/图书/dp/B011LPUAYI/ref=sr_1_1?ie=UTF8&amp;qid=1487685207&amp;sr=8-1&amp;keywords=构建之法" target="_blank" rel="noopener">亚马逊</a>）</p>
</blockquote>
<blockquote>
<p>整本书，极其认真，结构组织的有点像学术论文了。涵盖面比较全，涉及到了现代软件工程的整个流程，从需求的挖掘产生，到中间各个环节地循序渐进，直至最后的交付与维护支持。必然也就导致每个点深入程度相对较有限。</p>
</blockquote>
<blockquote>
<p>除了项目本身，本书另一个关注重点是项目中的人：项目经理、用户、测试、开发，讲到各种角色各自的职责，相互之间的协作关系、合作方法，最后一章中还有提到职业道德~（感觉有点偏向股东与雇主）</p>
</blockquote>
<blockquote>
<p>全书更多的是探讨方法论，关于开发、关于敏捷迭代、关于项目管理、关于结对编程、关于测试流程与种类、关于用户体验的获得与改进、关于需求分析与评审、关于软件工程师的成长。当然作者只是提供了一些自己的见解，很多观点并不一定准确，其中也有一些落伍的工具、模型。</p>
</blockquote>
<blockquote>
<p>更大的意义许是全面地概述一些需要注意的点，真正贯彻落实这些方法需要耗费极大成本。很多观点引人深思。</p>
</blockquote>
<hr>
<p><a href="https://www.evernote.com/l/ARsVoFkwFjJCdY6Llj0jxODvRc2NPL8xgTI" target="_blank" rel="noopener">EverNote链接</a></p>
<p><a href="https://www.evernote.com/shard/s283/sh/15a05930-1632-4275-8e8b-963d23c4e0ef/45cd8d3cbf318132/res/7853730d-412e-4220-9b6a-4fda39ca66a8/构建之法.xmind" target="_blank" rel="noopener">XMind文档</a></p>
<p><strong>导图</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1481332-7bcaba0014f30279.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="构建之法 overview.png"></p>
<p><strong>文本</strong><br>构建之法</p>
<p>1 个人<br>  1.1 2 个人和技术流程<br>    1.1.1 单元测试<br>        1.1.1.1 着眼于基本点；当事人编写；不改变机器状态；快；可重现；覆盖所有代码路径；与产品代码一同维护<br>    1.1.2 效能分析工具<br>        1.1.2.1 抽样、代码注入<br>    1.1.3 个人开发流程<br>        1.1.3.1 计划、开发、记录用时、测试报告、计算工作量、事后总结、提出过程改进计划<br>  1.2 3 软件工程师的成长<br>    1.2.1 大江东去，浪淘尽，千古风流人物<br>2 团队<br>  2.1 4 两人合作<br>    2.1.1 代码规范、设计规范、复审（驳回，选择性同意，放行）、结对编程、不同阶段的技巧<br>  2.2 5 团队和流程<br>    2.2.1 团队模式、开发流程<br>  2.3 6 敏捷流程<br>    2.3.1 敏捷问题与解法、敏捷团队（自主）、敏捷总结<br>  2.4 7 MSF<br>    2.4.1 MSF基本原则（共享、沟通、为共同目标努力、充分授权和信任、各司其职、敏捷）；MSF团队模型<br>3 产品<br>  3.1 8 需求分析<br>    3.1.1 软件需求（获取引导、分析定义、验证、管理）；利益相关者；用户调研（焦点小组、人类学、快速原型、AB测试）；竞争性需求分析框架（Need、Approach、Benefit、Competitors、Delivery）；功能定位与优先级（必要与辅助、核心与外围）；计划与估计；分而治之<br>  3.2 9 项目经理<br>    3.2.1 来历；职责（开发与测试之外的所有）；PM与风险管理；能力要求与任务（观察理解快速学习、分析管理、专业、自省）<br>  3.3 10 典型用户和场景<br>  3.4 12 用户体验<br>    3.4.1 要素（第一印象、换位思考、记住用户选择…）；设计的步骤与目标；评价标准（快反馈、贴近现实、暴露控制权、一致性与标准化、适合各种用户、帮助修复；提示语帮助）<br>4 质量<br>  4.1 11 软件设计与实现<br>    4.1.1 分析与设计方法；团队建模和分析方法；日常管理；<br>  4.2 13 软件测试<br>    4.2.1 分类方法（黑白、功能非功能、时机作用分类）；测试方法（UnitTest、BuildTest、AcceptanceTest、探索测试、回归测试、场景/集成/系统测试、伙伴测试、效能测试、压力测试、内外部测试、易用性测试）<br>  4.3 14 质量保障<br>    4.3.1 软件质量（程序、工程、如何衡量、成本）；质量保障工作（测试角色）<br>  4.4 15 稳定和发布阶段<br>    4.4.1 从完成到发布；渐进发布；发布之后——事后诸葛亮会议（赏罚、总结经验教训）<br>5 IT<br>  5.1 16 IT行业的创新<br>    5.1.1 争议点（创新与跟随、鼻祖与布道、专家？、技术创新为核心？、成功者更能创新？）；时机；招数<br>  5.2 17 人、绩效和职业道德<br>    5.2.1 猪鸡鹦鹉（成员投入程度不一）；人；绩效管理；职业道德（与公众利益一致、客户与雇主利益最大化、产出物满足高标准、专业判断、管理软件与开发维护、职业的诚信与声誉、对同事的支持与帮助、自身不断提高）</p>

      

    </div>
    <footer class="article-footer">

      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/读书/">读书</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/项目管理/">项目管理</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-技术/Android/ExampleModel_leak_fix_side_effect_correct_strategy"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/08/技术/Android/ExampleModel_leak_fix_side_effect_correct_strategy/">exampleModuleModel_leak_fix_side_effect_correct_strategy</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/08/技术/Android/ExampleModel_leak_fix_side_effect_correct_strategy/" class="article-date">
	  <time datetime="2018-03-07T16:35:35.000Z" itemprop="datePublished">2018-03-08</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>##</p>
<h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><ul>
<li>解决因修改exampleModule泄露导致的onUnBind/unbind调用模糊的问题</li>
<li>梳理exampleModule的主题切换流程逻辑</li>
</ul>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ul>
<li>部分类实现了onUnBind/unbind，但具体逻辑并不符合unbind（即完全释放）的预期</li>
<li>有些类实现了onUnBind/unbind，但并不是在销毁时调用（如：切换主题），直接调用会出问题</li>
<li>部分逻辑调用了onUnBind/unbind，但具体的类里却是空实现</li>
<li>有的类同时实现了onUnBind/unbind两者，onUnBind为空/unbind为空</li>
</ul>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>在unbind方法中加参数，对解绑动作做出具体的调用级区分，差异化实现逻辑，而不是像之前的方案一样统一都做销毁级别的处理</p>
<h3 id="主题切换流程"><a href="#主题切换流程" class="headerlink" title="主题切换流程"></a>主题切换流程</h3><ul>
<li>入口：ThemeMineList</li>
<li>具体调用栈<ul>
<li>流程图：</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">A[ThemeMineList] --&gt;|onClick-applyTheme| B(PageAcitvity)</span><br><span class="line">    B --&gt;|applyTheme| C[进程间通信ThemeApplyControllerImpl]</span><br><span class="line">    C --&gt;|applyTheme| D[ThemeResourceManager]</span><br><span class="line">    	D --&gt;|startApplyTheme -- applyAll | E[HostThemeCallBack]</span><br><span class="line">    	E --&gt;|onApplyAll| F[rebind flow]</span><br><span class="line">    	F --&gt;|Flow| H[callBindRunnable unbind/bind]</span><br></pre></td></tr></table></figure>
<ul>
<li>具体类名、方法名：<ul>
<li>ThemeMineList – onClick() – applyTheme()<ul>
<li>PageAcitvity.applyTheme() – 进程间通信<ul>
<li>ThemeManagerService$ThemeApplyControllerImpl.applyTheme<ul>
<li>ThemeResourceManager.startApplyTheme – applyAll<ul>
<li>exampleModuleModel$HostThemeCallBack.onApplyAll() – rebind – callBindRunnable() – unbind/bind</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="涉及场景"><a href="#涉及场景" class="headerlink" title="涉及场景"></a>涉及场景</h3><ol>
<li>点击清理图标动画没有完成时，切换主题</li>
<li>不保留活动，点击清理图标动画没有完成时进另一个Activity</li>
<li>改变AlertClockAppWidget的3D模式，原本的exampleModule代码里并没有实现具体onUnBind逻辑</li>
<li>删除快捷方式/删除桌面Widget</li>
<li>卸载应用</li>
<li>不保留活动，反复切换exampleModule至前台/后台</li>
</ol>
<h3 id="具体内容"><a href="#具体内容" class="headerlink" title="具体内容"></a>具体内容</h3><h3 id="onUnBind"><a href="#onUnBind" class="headerlink" title="onUnBind"></a>onUnBind</h3><p>调用——</p>
<ol>
<li>exampleModuleModel——MarketShortcutInfo</li>
<li>DeleteDropTarget——CustomShortcutInfo</li>
<li>AllAppsView——CustomShortcutInfo</li>
<li>DeleteDropTarget——CustomAppWidgetInfo // remove widget from workspace</li>
<li>exampleModule——AlertClockAppWidget// switch alert clock widget</li>
</ol>
<ul>
<li>destroy — MarketShortcutInfo</li>
<li>switchAlertClockWidget — AlertClockAppWidget</li>
<li>uninstallApp — CustomShortcutInfo</li>
<li>deleteDropTarget — CustomAppWidgetInfo</li>
<li>— CleanMemoryShortcutInfo</li>
<li>— ThemeShortcutInfo</li>
</ul>

      

    </div>
    <footer class="article-footer">

      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Performance/">Performance</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-技术/Android/diff Beta?"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/02/09/技术/Android/diff Beta?/">diff Beta?</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/02/09/技术/Android/diff Beta?/" class="article-date">
	  <time datetime="2018-02-08T16:35:35.000Z" itemprop="datePublished">2018-02-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="方案："><a href="#方案：" class="headerlink" title="方案："></a>方案：</h2><ol>
<li><p>代码中加开关控制</p>
</li>
<li><p>versionName/versionCode 加一些规则</p>
</li>
<li><p>ChannelID 控制</p>
</li>
</ol>
<h2 id="比较："><a href="#比较：" class="headerlink" title="比较："></a>比较：</h2><table>
<thead>
<tr>
<th style="text-align:left">方案</th>
<th style="text-align:center">优缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">代码开关</td>
<td style="text-align:center">灵活</td>
</tr>
<tr>
<td style="text-align:left">VersionName/VersionCode</td>
<td style="text-align:center"><ul><li>优势：发包时能够直观看到beta/production；</li><li>弊端：beta用户能够感知到这个版本号</li></ul></td>
</tr>
<tr>
<td style="text-align:left">ChannelID</td>
<td style="text-align:center">缺点：影响数据统计/分析</td>
</tr>
</tbody>
</table>
<blockquote>
<p>关于VersionName/VersionCode区分beta的实现方法：</p>
<ol>
<li>可以直接在VersionName中写上alpha/beta 字段区分</li>
<li>可以利用VersionCode处理（比如奇偶/是否被n整除）</li>
</ol>
</blockquote>
<h2 id="结论："><a href="#结论：" class="headerlink" title="结论："></a>结论：</h2><ul>
<li>推荐方案1或2</li>
</ul>

      

    </div>
    <footer class="article-footer">

      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-技术/程序/【分享】Https"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
    <div class="article-meta">
      
	<a href="/2017/08/26/技术/程序/【分享】Https/" class="article-date">
	  <time datetime="2017-08-26T08:18:21.000Z" itemprop="datePublished">2017-08-26</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a><a class="article-category-link" href="/categories/技术/程序/">程序</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        
      

    </div>
    <footer class="article-footer">

      
      
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-每周一书/【读书笔记】深入理解Android内核设计思想"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/08/13/每周一书/【读书笔记】深入理解Android内核设计思想/">【读书笔记】深入理解Android内核设计思想</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/08/13/每周一书/【读书笔记】深入理解Android内核设计思想/" class="article-date">
	  <time datetime="2017-08-12T16:35:35.000Z" itemprop="datePublished">2017-08-13</time>
	</a>

      
    <a class="article-category-link" href="/categories/阅读/">阅读</a><a class="article-category-link" href="/categories/阅读/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>这本书太深了，不适合略读，可以在碰到相关问题时仔细研读，知识覆盖面较广</p>
</blockquote>
<p>这么多大块的时间来一条条钻研这些内核实现细节其实不如学习算法来的有用，毕竟一个是形式，一个是内功</p>
<blockquote>
</blockquote>
<p>留待查阅</p>
<hr>
<p><a href="https://www.evernote.com/l/ARvkJbs0vmxOJZn5WVExzJGV7jJHClXEVtY" target="_blank" rel="noopener">印象笔记链接（附带XMind文件）</a></p>
<p>图片：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1481332-228b08c1632f933b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="深入理解Android 内核设计思想 overview.png"></p>
<hr>
<p>#笔记文字</p>
<p>深入理解Android内核思想<br>1 4 操作系统基础<br>  1.1 4.3 进程间通信的经典实现<br>    1.1.1 共享内存<br>    1.1.2 管道pipe<br>        1.1.2.1 管道是单向的<br>        1.1.2.2 有容量限制<br>    1.1.3 Unix domain socket<br>        1.1.3.1 专门针对单机的进程间通信，并不依赖Network socket 的那些TCP/IP协议<br>        1.1.3.2 Android上使用最多的一种IPC机制是Binder，其次就是UDS<br>    1.1.4 RPC（Remote Procedure Calls）<br>  1.2 4.4 同步机制的经典实现<br>    1.2.1 定义<br>        1.2.1.1 如果多个进程间存在时序关系，需要协同工作以完成一项任务，则称为同步<br>        1.2.1.2 如果它们并不满足协同条件，而只是因为共享具有排他性资源时所产生的关系，称为互斥<br>    1.2.2 信号量（Semaphore）<br>        1.2.2.1 信号量与PV原语操作 是使用最广泛的互斥方法之一<br>        1.2.2.2 PV原语都属于原子操作（Atomic Operations）<br>    1.2.3 Mutex（Mutual Exclusion）<br>    1.2.4 管程（Monitor）<br>        1.2.4.1 对Semaphore机制的延伸和改善，是一种控制更为简单的同步手段<br>        1.2.4.2 管程中的方法都是受Mutex保护的，意味着同一时刻只允许有一个访问者使用它们<br>  1.3 4.5 Android中的同步机制<br>    1.3.1 Mutex<br>    1.3.2 Condition<br>    1.3.3 Barrier<br>        1.3.3.1 Barrier是填充了具体条件的Condition<br>        1.3.3.2 专门为SurfaceFlinger而设计<br>  1.4 4.6 操作系统内存管理基础<br>    1.4.1 核心点：虚拟内存、内存分配与回收、内存保护<br>    1.4.2 虚拟内存<br>        1.4.2.1 地址空间<br>                1.4.2.1.1 逻辑地址，也称相对地址，是程序编译后所产生的地址<br>                1.4.2.1.1.1 组成部分： Segment Selector + Offset<br>                1.4.2.1.2 线性地址<br>                1.4.2.1.3 物理地址<br>    1.4.3 内存保护<br>    1.4.4 内存分配与内存回收<br>    1.4.5 进程间通信mmap<br>  1.5 4-7 Android中的Low Memory Killer<br>    1.5.1 OOMKiller<br>    1.5.2 策略考虑因素<br>        1.5.2.1 进程消耗的内存<br>        1.5.2.2 进程占用的CPU时间<br>        1.5.2.3 oom_adj（OOM权重）<br>    1.5.3 自己改变oom_adj？<br>        1.5.3.1 1 写文件 ： /proc/<pid>/oom_adj<br>        1.5.3.2 2 android:persistent 添加到application标签中，设置应用为常驻内存<br>  1.6 4-8 Android 匿名共享内存<br>    1.6.1 Anonymous Shared Memory<br>    1.6.2 Ashmem 设备<br>        1.6.2.1 创建时机<br>        1.6.2.2 操作函数及实现原理<br>        1.6.2.3 Linux 共享机制的区别与联系<br>    1.6.3 Ashmem应用实例<br>  1.7 4-9 JNI<br>2 5 Android 进程/线程管理<br>  2.1 5.1 Android进程和线程<br>    2.1.1 Activity启动后，除了主线程 ActivityThread之外还需要两个Binder线程<br>    2.1.2 Service与Activity一样，也寄存于ActivityThread之中，并且启动流程和Activity基本一致<br>    2.1.3 启动Service时，同样也需要两个Binder线程支持<br>    2.1.4 对于同一个AndroidManifest.xml中定义的四大组件，除非有特别声明，否则它们都运行于同一个进程中<br>    2.1.5 Android提供了特殊的方式让不是同一个包里的组件也可以运行于相同的进程中，优势是可以方便地进行资源共享<br>        2.1.5.1 针对个别组件，可以在标签中加入android:process<br>        2.1.5.2 针对整个包，直接在<application>标签中加入android:process属性来指明<br>  2.2 5.2 Handler， MessageQueue Runnable， Looper<br>    2.2.1 Handler<br>        2.2.1.1 功能：处理Message、将Message压入MessageQueue<br>        2.2.1.2 函数<br>                2.2.1.2.1 post<br>                2.2.1.2.1.1 post<br>                2.2.1.2.1.2 postAtTime<br>                2.2.1.2.1.3 postDelay<br>                2.2.1.2.2 send<br>                2.2.1.2.2.1 sendEmptyMessage<br>                2.2.1.2.2.2 sendMessageAtFrontOfQueue<br>                2.2.1.2.2.3 sendMessageAtTime<br>                2.2.1.2.2.4 sendMessageDelay<br>    2.2.2 MessageQueue<br>    2.2.3 Looper<br>        2.2.3.1 分为两种：主线程、普通线程<br>        2.2.3.2 ThreadLocal 成员变量<br>  2.3 5.3 UI主线程——ActivityThread<br>    2.3.1 prepareMainLooper<br>        2.3.1.1 prepare<br>        2.3.1.2 不允许退出<br>    2.3.2 sMainThreadHandler<br>        2.3.2.1 创建处理消息环境<br>        2.3.2.2 循环处理消息<br>  2.4 5.4 Thread类<br>    2.4.1 内部原理<br>        2.4.1.1 implements Runnable<br>        2.4.1.2 state<br>                2.4.1.2.1 NEW, RUNNABLE, BLOCKED, WAITING, TIMED_WAITING, TERMINATED<br>    2.4.2 休眠和唤醒<br>        2.4.2.1 相关方法：wait,notify,notifyAll, interrupt,join, sleep<br>        2.4.2.2 wait和notify/notifyAll<br>        2.4.2.3 interrupt<br>        2.4.2.4 join<br>                2.4.2.4.1 保证两个线程顺序执行<br>                2.4.2.4.2 带时间参数的join，保证在规定时间没有执行完前面的线程，也会继续执行后面的语句，防止无限等待<br>        2.4.2.5 sleep<br>                2.4.2.5.1 wait等待某个object<br>                2.4.2.5.2 sleep则是等待时间<br>3 6. 进程间通信——Binder<br>  3.1 组成<br>    3.1.1 Binder驱动<br>    3.1.2 Service Manager<br>        3.1.2.1 在Binder通信中的唯一标志永远都是0<br>    3.1.3 Binder Client<br>    3.1.4 Binder Server<br>  3.2 智能指针<br>    3.2.1 引用计数器，由object自身持有<br>    3.2.2 强指针SP<br>    3.2.3 弱指针WP，主要使命是解决循环引用的问题<br>        3.2.3.1 弱指针必须升级为强指针才能访问它所指向的对象<br>  3.3 进程间的数据传递载体——Parcel<br>  3.4 Binder 驱动协议<br>  3.5 ServiceManager[Binder Server]<br>    3.5.1 类似“DNS”服务器<br>  3.6 Binder Client<br>  3.7 Android接口描述语言AIDL<br>  3.8 匿名Binder Server<br>4 7. Android启动过程简析<br>  4.1 第一个系统进程 init<br>  4.2 系统关键服务的启动简析<br>5 8. 管理Activity和组件运行状态的系统进程 Activity Manager Service（AMS）<br>  5.1 AMS功能概述<br>    5.1.1 寄存于SystemServer中。会在系统启动时创建一个线程来循环处理客户请求<br>  5.2 ActivityStack<br>    5.2.1 ActivityState<br>    5.2.2 ArrayList<br>    5.2.3 记录特殊状态下的Activity<br>  5.3 startActivity流程<br>  5.4 ActivityTask<br>    5.4.1 android:taskAffinity<br>        5.4.1.1 当启动Activity的Intent中带有FLAG_ACTIVITY_NEW_TASK标志时<br>                5.4.1.1.1 表示它希望为activity新开一个task， 如果有task的affinity与新Activity的affinity一样，则会复用此task，否则，新建task<br>        5.4.1.2 当Activity中的allowTaskReParenting属性设置为true时<br>                5.4.1.2.1 Activity具有动态转移能力<br>    5.4.2 android:alwaysRetainTaskState<br>6 9. GUI系统之SurfaceFlinger<br>7 11. View体系<br>  7.1 应用程序中的View框架<br>    7.1.1 ViewRoot是View的管理者，ViewRoot的核心任务就是与WindowManagerService进行通信<br>    7.1.2 Activity内部有一个mWindow成员变量<br>    7.1.3 Window与WindowManagerImpl的关系<br>        7.1.3.1 一个应用可能有很多个Window，不会让它们单独地与WMS通信<br>    7.1.4 ViewRoot与WindowManagerImpl的关系<br>  7.2 Activity中ViewTree的创建过程<br>    7.2.1 有了Window以后生成具体的内容由setContentView发起，设置mDecor<br>  7.3 在WMS中注册窗口<br>  7.4 ViewRoot的基本工作方式<br>  7.5 ViewTree的遍历时机<br>  7.6 ViewTree的遍历流程<br>  7.7 View 和 ViewGroup属性<br>  7.8 Canvas<br>  7.9 draw和onDraw<br>  7.10 View中的消息传递<br>  7.11 View动画<br>8 12. InputManager Service与输入事件<br>  8.1 事件分类<br>    8.1.1 KeyEvent<br>    8.1.2 TouchEvent<br>    8.1.3 MouseEvent<br>    8.1.4 TrackBallEvent<br>  8.2 事件的投递流程<br>9 13. 音频系统<br>  9.1 基础<br>  9.2 框架<br>  9.3 核心<br>  9.4 策略制定者<br>  9.5 回放<br>  9.6 数据流<br>  9.7 音量控制<br>  9.8 上层建筑<br>  9.9 支持的格式<br>  9.10 ID3简介<br>  9.11 多媒体文件管理<br>10 14. Intent匹配规则<br>  10.1 Intent 属性<br>  10.2 匹配规则<br>  10.3 源码简析<br>11 15. APK应用程序的资源适配<br>  11.1 资源类型<br>  11.2 可选资源<br>  11.3 最佳匹配流程<br>  11.4 屏幕适配<br>12 16. Android字符编码格式<br>  12.1 ISO/IEC 8859<br>  12.2 ISO/IEC 10646<br>  12.3 Unicode<br>  12.4 String类型<br>13 17. Android和OpenGL ES<br>  13.1 3D 基础<br>  13.2 OpenGL SE<br>  13.3 API-EGL<br>  13.4 GLSurfaceView<br>14 18. SystemUI<br>  14.1 组成元素<br>  14.2 实现<br>  14.3 壁纸<br>15 19. Widget<br>  15.1 AppWidgetProvider<br>  15.2 AppWidgetHost<br>16 20. 编译和打包<br>  16.1 Ant<br>  16.2 命令行<br>  16.3 编译过程<br>  16.4 信息安全<br>  16.5 签名<br>  16.6 签名源码<br>17 21. 版本控制<br>  17.1 Git<br>18 22. 调试工具<br>  18.1 Emulator<br>  18.2 ADB</application></pid></p>

      

    </div>
    <footer class="article-footer">

      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/读书/">读书</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-日常记录/心能转物即同如来"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/08/13/日常记录/心能转物即同如来/">心能转物即同如来</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/08/13/日常记录/心能转物即同如来/" class="article-date">
	  <time datetime="2017-08-12T16:35:35.000Z" itemprop="datePublished">2017-08-13</time>
	</a>

      
    <a class="article-category-link" href="/categories/阅读/">阅读</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>题引自佛经《楞严经》，闻自一师友<br>恐忘遂墨</p>
</blockquote>
<hr>
<p><strong>无住相布施</strong></p>
<blockquote>
<p>如果不是不求回报地帮助，就不要帮助</p>
</blockquote>
<hr>
<p><strong>心能转物即同如来</strong></p>
<blockquote>
<p>出自《楞严经》<br>此处物非“物质”<br>谓一切圣贤，能转万物，不被万物所转，随心自在，处处真如。<br>可以联想《礼记 大学》八目中的“格物致知”</p>
</blockquote>
<hr>
<p><strong>收束万心做一事，再用一心做万事</strong></p>
<hr>
<p><strong><a href="https://zh.wikipedia.org/wiki/马太效应" target="_blank" rel="noopener">马太效应</a></strong></p>
<blockquote>
<p>（引自维基百科）<br><em>1968年，美国科学史学者罗伯特·莫顿提出这个术语用以概括一种社会心理现象：“相对于那些不知名的研究者，声名显赫的科学家通常得到更多的声望，即使他们的成就是相似的，同样地，在同一个项目上，声誉通常给予那些已经出名的研究者，例如，一个奖项几乎总是授予最资深的研究者，即使所有工作都是一个研究生完成的。”</em></p>
</blockquote>
<blockquote>
<p><em>指科学界的名聲累加的一种反饋现象，最早由美國學者罗伯特·莫顿於1968年提出[1][2]。其名稱来自于《新约圣经·马太福音》中的一则寓言[3]。
</em></p>
</blockquote>
<hr>
<p><strong><a href="https://zh.wikipedia.org/zh-cn/复利" target="_blank" rel="noopener">复利效应</a></strong></p>
<blockquote>
<p>（引自维基百科）<br><em>复利是现代理财一个重要概念，由此产生的财富增长，称作“复利效应”，对财富可以带来深远的影响。假设投资每年的回报率是100%，本金10万，如果只按照普通利息计算，每年回报只有10万元，10年亦只有100万元，整体财富增长只是10倍，但按照复利方法计算，首年回报是10万元，令个人整体财富变成20万，第二年20万会变成40万，第三年40万再变80万元，10年累计增长将高达1024倍（2的10次方），亦即指10万元的本金，最后会变成1.024亿元。</em></p>
</blockquote>
<blockquote>
<p><em>人类历史中，要长期达到每年100%回报是几近不可能，以华人首富李嘉诚为例，1950年以7,000美元成立长江塑胶厂（改组后成为长江和记实业有限公司，地产方面成为长江实业地产有限公司），在2006年拥有约188亿美元身家计算，撇开其他因素，他的财富在57年增长268.6万倍，其每年的复利回报亦仅为26.68%((188亿/7000)开57次方=1.2966)。</em></p>
</blockquote>
<hr>
<p>听闻这些佛经小解之后，昨天回去迫不及待地查阅了一下《金刚经 心经》，发现对我来说就是天书：</p>
<blockquote>
<p>金刚经 第八品 依法出生分<br>“须菩提！于意云何？若人满三千大千世界七宝以用布施，是人所得福德，宁为多不？”须菩提言：“甚多，世尊！何以故？是福德即非福德性，是故如来说福德多。”“若复有人，于此经中受持，乃至四句偈等，为他人说，其福胜彼。何以故？须菩提！一切诸佛，及诸佛阿耨多罗三藐三菩提法，皆从此经出。须菩提！所谓佛法者，即非佛法。”</p>
</blockquote>
<p><strong>信，解，行，证</strong>——是为学经四部曲</p>
<hr>
<p>最后，附师诗一首：</p>
<blockquote>
<p>万物皆寂灭<br>法本一明觉<br>归源真性显<br>心如庙会生</p>
</blockquote>

      

    </div>
    <footer class="article-footer">

      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/佛经/">佛经</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/4/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/6/">下一页 &raquo;</a>
  </nav>

</section>
        
      </div>
      
        <div align="center" style="margin-top: 30px;"><hr class="hr" style="margin:0px; height:3px;"></div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="/about/" target="_blank">KyleCe</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2015 - 2018 KyleCe All Rights Reserved.</p>

	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>


  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>


  <script src="/js/home.js"></script>










	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            KyleCe
          </div>
          <div class="panel-body">
            Copyright © 2018 KyleCe All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
</body>
</html>