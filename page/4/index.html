<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>KyleCe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="KyleCe">
<meta property="og:url" content="https://github.com/KyleCe/kylece.github.io/page/4/index.html">
<meta property="og:site_name" content="KyleCe">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="KyleCe">
  
    <link rel="alternate" href="/atom.xml" title="KyleCe" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/avatar.jpg">
  <link rel="apple-touch-icon" href="/css/images/avatar.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/home.css" >
  

  

  

  
  
  

</head>



  <body>


  
    <header id="header">

	<!-- 背景图模式 -->
	

    
      <div id="intrologo" class="intro-logo" style="background-position:center; background-repeat:no-repeat; background-image: url(); background-size: auto 100%;">

      <!-- Support rolling -->  
        
        <section class="awSlider">
          <div class="carousel slide carousel-fade " data-ride="carousel">

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
               
                  
                    <div class="item active">
                  
                    <img id="carousel-img0" src="/css/images/home-bg.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img0 = new Image();
                      var imageTag0 = document.getElementById("carousel-img0");
                      img0.src = imageTag0.src;
                      img0.onload=function(){
                        if (img0.width / img0.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag0.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag0.style.height = document.body.clientHeight + "px";
                          imageTag0.style.marginLeft = -(document.body.clientHeight * img0.width / img0.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img1" src="/css/images/sample.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img1 = new Image();
                      var imageTag1 = document.getElementById("carousel-img1");
                      img1.src = imageTag1.src;
                      img1.onload=function(){
                        if (img1.width / img1.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag1.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag1.style.height = document.body.clientHeight + "px";
                          imageTag1.style.marginLeft = -(document.body.clientHeight * img1.width / img1.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img2" src="https://source.unsplash.com/collection/954550/1920x1080">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img2 = new Image();
                      var imageTag2 = document.getElementById("carousel-img2");
                      img2.src = imageTag2.src;
                      img2.onload=function(){
                        if (img2.width / img2.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag2.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag2.style.height = document.body.clientHeight + "px";
                          imageTag2.style.marginLeft = -(document.body.clientHeight * img2.width / img2.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href=".carousel" role="button" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">Geri</span>
            </a>
            <a class="right carousel-control" href=".carousel" role="button" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">İleri</span>
            </a>
          </div>
        </section>
        <script>
          $('section.awSlider .carousel').carousel({
              pause: '',
              interval: 5000
          });
          var startImage = $('section.awSlider .item.active > img').attr('src');
          $('section.awSlider .carousel').on('slid.bs.carousel', function () {
              var bscn = $(this).find('.item.active > img').attr('src');
              $('section.awSlider > img').attr('src', bscn);
          });
        </script>
      

    
 


    <canvas width="100%" height="100%"></canvas>
    <script>
      var c = document.getElementsByTagName('canvas')[0],
          x = c.getContext('2d'),
          w = window.innerWidth,
          h = window.innerHeight,
          pr = window.devicePixelRatio || 1,
          f = 90,
          q,
          m = Math,
          r = 0,
          u = m.PI*2,
          v = m.cos,
          z = m.random
      c.width = w*pr
      c.height = h*pr
      x.scale(pr, pr)
      x.globalAlpha = 0.6

      <!-- 折线Polyline背景 -->
      
    </script>
    

    
      <div id="homelogo" class="homelogo" style="background: rgba(255,255,255,1);"> 
    

        
          <div class="homelogoback"  style="border: 1px solid #404040;" >
            <h1><a href="#content" id="logo">KyleCe</a></h1>
            <h3></h3>
            <h5>KyleCe</h5>
            <!-- <p><a href="https://github.com/iTimeTraveler" target="_blank">Github</a></p> -->
          </div>
        
    
    </div>
  </div>

  <!-- 自适应主页背景大图 -->
  

 <!-- home_logo_image居中 -->
 
    <script>
        var homelogodiv = document.getElementById("homelogo");
        if (document.all.homelogo.offsetWidth > document.body.clientWidth) {
          homelogodiv.style.width = document.body.clientWidth + "px";
          homelogodiv.style.marginLeft = document.body.clientWidth * -0.5 + "px";
        } else {
          homelogodiv.style.width = homelogodiv.clientWidth  + "px";
          homelogodiv.style.marginLeft = (homelogodiv.clientWidth)  * -0.5 + "px";
        }
    </script>
  

  <div class="intro-navigate">
      <p class="navigater-list">
        
          <a id="beautifont" class="main-nav-link" href="/">首页</a>
        
          <a id="beautifont" class="main-nav-link" href="/archives">归档</a>
        
          <a id="beautifont" class="main-nav-link" href="/categories">分类</a>
        
          <a id="beautifont" class="main-nav-link" href="/tags">标签</a>
        
          <a id="beautifont" class="main-nav-link" href="/about">关于</a>
        
      </p>
  </div>

</header>
  
  <div id="container">
    <div id="wrap">
      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;">
  
    <article id="post-技术/Android/【Android】VectorDrawable介绍"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/【Android】VectorDrawable介绍/">VectorDrawable介绍</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/【Android】VectorDrawable介绍/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>引<br>今天视频处理中碰到一些简单图片的vector绘制方案<br>调研结果：</p>
</blockquote>
<p>效果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1481332-9a7da5968fccb57a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="vector paint eg.png"></p>
<p><strong>优点</strong>：Vector与PNG文件相比，能极大地缩小文件占用空间；<br><strong>弱势</strong>：</p>
<ol>
<li>兼容性处理起来需要花费一些心思；</li>
<li>复杂图片不适合运用vector绘制，一个是初始化效率，第二个是重复使用时bitmap在GPU中会有缓存，而vector没有；</li>
<li>需要额外的一些辅助工具协作生成path；</li>
</ol>
<blockquote>
<p>例注：</p>
<ol>
<li>使用：<br>需要在Gradle 中添加：android.defaultConfig域<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vectorDrawables.useSupportLibrary = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<ol>
<li>XML attributes:  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viewportHeight \ viewportWidth</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>划分的比例大小（图片中的例子：36dp大小的图像划分成24份，Path中的坐标建立在划分后的坐标系统之上）<br><code>意义--&gt;将大小与path分离</code></p>
<hr>
<p>Path指令：<br>M = moveto(M X,Y)<br>L = lineto(L X,Y)<br>H = horizontal lineto(H X)<br>V = vertical lineto(V Y)<br>C = curveto(C X1,Y1,X2,Y2,ENDX,ENDY)：三次贝赛曲线<br>S = smooth curveto(S X2,Y2,ENDX,ENDY)<br>Q = quadratic Belzier curve(Q X,Y,ENDX,ENDY)：二次贝赛曲线<br>T = smooth quadratic Belzier curveto(T ENDX,ENDY)：映射<br>A = elliptical Arc(A RX,RY,XROTATION,FLAG1,FLAG2,X,Y)：弧线<br>Z = closepath()</p>
<hr>
<p>工具：<br><a href="http://inloop.github.io/svg2android/" target="_blank" rel="noopener">to vector</a><br><a href="http://editor.method.ac/" target="_blank" rel="noopener">SVG editor</a></p>
<hr>
<blockquote>
<p>参考：(涵盖由头、Vector语法、转换工具、原理、兼容处理、性能考量等方面知识，良心之作)<br><a href="http://www.jianshu.com/p/e3614e7abc03" target="_blank" rel="noopener">Android Vector曲折的兼容之路</a></p>
</blockquote>
<hr>
<p>关注公众号“夕识”，雕刻时光，雕刻思维<br><img src="http://upload-images.jianshu.io/upload_images/1481332-c461a8ddbf8cf08e.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VectorDrawable/">VectorDrawable</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-技术/Android/【Android】JNI-Tips-提要"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/【Android】JNI-Tips-提要/">JNI-Tips-提要</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/【Android】JNI-Tips-提要/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>引：<br>项目需要用到JNI，实际上还需要在native跟Java之间写一些代码，来连接二位，需要做进一步了解。本文主要对官方的JNI Tips做一些简单的关键提取<br>参考：<br><a href="">JNI Tips</a></p>
</blockquote>
<hr>
<p><a href="https://www.evernote.com/l/ARunDTJCHX9AQ5Zm7URUjILWW2iFBUVWGRc" target="_blank" rel="noopener">Evernote连接</a></p>
<p><a href="https://www.evernote.com/shard/s283/sh/a70d3242-1d7f-4043-9666-ed44548c82d6/5b68850545561917/res/ba76fe6f-7df9-41f8-a0cd-1f0dcbe4349c/JNI%20Tips.xmind" target="_blank" rel="noopener">XMind 文档下载</a></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1481332-ce0301d2d61fe60b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="JNI Tips.png"></p>
<p>文本：</p>
<p>JNI Tips</p>
<p>definition<br>  Java Native Interface<br>  how it works<br>    <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/jniTOC.html" target="_blank" rel="noopener">http://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/jniTOC.html</a><br>JavaVM and JNIEnv<br>  JavaVM<br>    one process can only create one JavaVM in Android<br>  JNIEnv<br>    provides most of JNI functions. Your native functions all receive a JNIEnv as first argument<br>    used for thread-local, so you cannot share a JNIEnv between threads (GetEnv can be used to discover the thread’s JNIEnv when no other way)<br>Threads<br>  a thread will have no JNIEnv unless it’s attached, before this it cannot make JNI calls (all threads are Linux threads, scheduled by the kernel)<br>  Threads attached through JNI must call DetachCurrentThread before they exit<br>jclass, jmethodID, and jfieldID<br>  steps to access an object’s field from native code<br>    FindClass:—&gt; get the class object reference for the class<br>    GetFieldID:—&gt;Get the field ID for the field with GetFieldID<br>    GetIntField:—&gt;Get the contents of the field with something appropriate<br>  call a method—&gt; get a class object reference and then a method ID<br>  it’s useful to look the values up once and cache the results in your native code. Because there is a limit of one JAVAVM per process<br>  if want to cache IDs when a class is loaded, add a piece of code that allow the native code to cache field offsets<br>Local and Global Reference<br>  almost every object returned by a JNI function is a “local reference”—&gt;it’s valid for the duration of the current native method in the current thread. Even if the object itself continues to live on after the native method returns, the reference is not valid<br>  the only way to get non-local references is via the functions NewGlobalRef and NewWeakGlobalRef (the global reference is guaranteed to be valid until you call DeleteGlobalRef)<br>  to see if two reference refer to the same object, you must use the IsSameObject function, never use == in native code<br>  jfieldIDs, jmethod are opaque types, not object references, should not be passed to NewGlobalRef<br>  if you attach a native thread with AttachCurrentThread, the code you are running will never automatically free local references until the thread detaches. Any local references you create will have to be deleted manually.<br>UTF-8 and UTF-16 Strings<br>  java use UTF-16, JNI provides methods that work with Modified UTF-8 as well.<br>  you cannot pass arbitrary UTF-8 data to JNI and expect it to work correctly<br>  Android currently does not require a copy in GetStringChars,however GetStringUTFChars requires an allocation and a conversion to UTF-8. UTF-16 strings are not zero-terminated, \u0000 is allowed, so you need to hang on to the string length like jchar pointer<br>  Don’t forget to Release the strings you Get. the string functions return jchar<em> or jbyte</em><br>  Data passed to NewStringUTF must be in Modified UTF-8 format<br>Primitive Arrays<br>  You must Release every array you Get<br>  release mode arguments alternative values<br>    0<br>        buffer freed<br>    JNI_COMMIT<br>        do nothing/ buffer not freed<br>    JNI_ABORT<br>        buffer freed, Earlier wirtes are not aborted<br>Region calls<br>  advantages<br>    reducing overhead by reducing JNI call requirements<br>    do not require pinning or extra data copies<br>    reduces the risk of programmer error–&gt; no risk of forgetting to call Release<br>Exception<br>  your must not call JNI functions while an exception is pending, except several special kinds of API: delete/ exception process/stack process/ release process …<br>Extended Checking<br>  JNI does very little error checking ~~!<br>  Android offers a mode called CheckJNI<br>    array, bad pointers, Class names, Critical call,Direct ByteBuffers, Exceptions, JNIEnv<em>s, jmethodIDs, References,Release modes, Type safety, UTF-8<br>Native Libraries<br>  steps<br>    call System.loadLibrary<br>    provide a native function : jint JNI_OnLoad(JavaVM</em> vm void* reserved)<br>    in JNI_OnLoad, register all your native methods<br>64-bit Considerations<br>  you need to stash your native pointers in a long field rather than an int<br>Unsupported Features/ Backwards Compatibility<br>  Define class<br>  dynamic lookup of native functions<br>  detaching threads<br>  weak global references<br>  Local references<br>  determining reference type with GetObjectRefType</p>
<hr>
<p>关注公众号“夕识”，雕刻时光，不负流年<br><img src="http://upload-images.jianshu.io/upload_images/1481332-c461a8ddbf8cf08e.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JNI/">JNI</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-技术/Android/【Android】Clean-Architecture--初析"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/【Android】Clean-Architecture--初析/">Clean-Architecture--初析</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/【Android】Clean-Architecture--初析/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>本篇承接 <a href="http://www.jianshu.com/p/43fcba217459" target="_blank" rel="noopener">_上文_</a><br>参考：</p>
<ol>
<li><a href="https://fernandocejas.com/2014/09/03/architecting-android-the-clean-way/" target="_blank" rel="noopener">Architecting Android…The clean way?</a></li>
<li><a href="https://github.com/android10/Android-CleanArchitecture">Clean Architeture Sample -By android10</a></li>
</ol>
</blockquote>
<hr>
<p>色彩简化后的结构图：<br><img src="http://upload-images.jianshu.io/upload_images/1481332-fe3d6bffa3c4e274.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ease_clean_architecture.png"></p>
<p>想表达的是依赖层级，从这幅图可以看出，模块之间的依赖关系在理想情况下是清晰的，也不存在多维度相互依赖的问题，最外层UI依赖Presenter层，Presenter层又依赖Use Cases层，以此类推…  （<strong>每层的依赖只能向内收缩</strong>）</p>
<p><em>当然，这里的层级内涵只是举例示意，在实际业务中需要根据需要设定各层核心，层级数也可适量调整，整个架构强调的只是一种依赖收缩的思想</em></p>
<hr>
<blockquote>
<p>一个例子：<br><img src="http://upload-images.jianshu.io/upload_images/1481332-2b039b1c3b887476.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="clean_architecture_android_schema.png"><br>架构分为三层：</p>
<pre><code>1. Presentation
2. Domain
3. Data
</code></pre><hr>
<p><strong>Presentation</strong><br><img src="http://upload-images.jianshu.io/upload_images/1481332-d9f5b06f606cdb68.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="clean_architecture_mvp.png"><br>要点即是大家熟知的MVP一类；<br>Android的代码应该全部都出现在这一层</p>
</blockquote>
<blockquote>
<p><strong>Domain</strong><br><img src="http://upload-images.jianshu.io/upload_images/1481332-f216b0617d67dbdc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="clean_architecture_domain.png"><br>业务逻辑层，代码应该是纯粹的JAVA API，与Android无关</p>
</blockquote>
<blockquote>
<p>Data<br><img src="http://upload-images.jianshu.io/upload_images/1481332-e536090a22ea7452.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="clean_architecture_data.png"><br>这一层主要是处理数据业务</p>
</blockquote>
<p>几张图其实能很清楚地说明Clean Architecture的立意、用法</p>
<hr>
<p>关注公众号“夕识”，雕刻时光，雕刻思维<br><img src="http://upload-images.jianshu.io/upload_images/1481332-c461a8ddbf8cf08e.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AndroidStudio/">AndroidStudio</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-技术/Android/【Android】Android-Clean-Architecture推介"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/【Android】Android-Clean-Architecture推介/">Android-Clean-Architecture推介</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/【Android】Android-Clean-Architecture推介/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p><a href="https://medium.com/@dmilicic/a-detailed-guide-on-developing-android-apps-using-the-clean-architecture-pattern-d38d71e94029#.c9wgdy880" target="_blank" rel="noopener">A detailed guide on developing Android apps using the Clean Architecture pattern</a></p>
</blockquote>
<p>本文为Clean Architecture在Android App开发中的guideline</p>
<hr>
<p>Bob大叔所作Clean Architecture结构图如下：<br><img src="http://upload-images.jianshu.io/upload_images/1481332-d8356f0cf9fa5894.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="clean architecture.jpg"></p>
<p>使用Clean Architecture具有如下优点：</p>
<pre><code>1. 独立于Frameworks
2. 易测试.
3. 独立于UI.
4. 独立于Database.
5. 独立于外部 agency.
</code></pre><hr>
<p>Android应用常用的3层架构：</p>
<pre><code>Outer: Implementation layer  实现层
Middle: Interface adapter layer 接口适配层
Inner: Business logic layer 业务逻辑层（——应可用独立于Android的测试用例进行测试）
</code></pre><p>分别为：</p>
<ol>
<li><strong>Outer layer</strong><br>UI、Storage、Network等</li>
<li><strong>Middle layer</strong><br>Presenters、Converters        </li>
<li><strong>Inner layer</strong><br>POJOs、Interactors、Model、Repositories、Executors</li>
</ol>
<hr>
<p>识别二维码，关注公众号“夕识”<br><img src="http://upload-images.jianshu.io/upload_images/1481332-c461a8ddbf8cf08e.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Architecture/">Architecture</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-技术/Android/【Android】AS添加JNI支持"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/【Android】AS添加JNI支持/">AS添加JNI支持</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/【Android】AS添加JNI支持/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p><em>JNI入坑</em></p>
</blockquote>
<blockquote>
<p>索引：</p>
<ol>
<li>旧  NDK  使用姿势(AS 2.2 以下 <a href="https://codelabs.developers.google.com/codelabs/android-studio-jni/index.html?index=..%2F..%2Findex#2" target="_blank" rel="noopener">参考链接：Create hello-JNI with android studio</a>)</li>
<li>新  NDK  使用方法(AS 2.2及以上 <a href="https://developer.android.google.cn/studio/projects/add-native-code.html" target="_blank" rel="noopener">参考链接：Add C and C++ Code to Your Project</a>)</li>
</ol>
</blockquote>
<blockquote>
<p>参考：<br><a href="https://developer.android.google.cn/training/articles/perf-jni.html?hl=zh-cn" target="_blank" rel="noopener">JNI Tips</a><br>(链接均需VPN)</p>
</blockquote>
<hr>
<h4 id="旧-NDK-build："><a href="#旧-NDK-build：" class="headerlink" title="旧  NDK-build："></a>旧  NDK-build：</h4><p>简单来说分这么几步：</p>
<ol>
<li>添加ndk库支持</li>
<li><p>在 gradle.properties中添加：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android.useDeprecatedNdk=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在 app级build.gradle中添加：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  defaultConfig &#123;</span><br><span class="line">        ndk &#123;</span><br><span class="line">            moduleName <span class="string">"test-jni"</span> <span class="comment">// name the jni lib you want to add</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建load 静态块，添加待实现native api</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JniTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"test-jni"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">getMsgFromJni</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>在 目标api所在行停留一会，会出现红色灯泡提示按钮，点击图标，会有<code>Create Function Java_%full class name%_getMsgFromJni</code>选项出现；点击之后会自动创建一个与java目录并列的cpp目录，并在目录下生成<code>test-jni.c</code>文件<br>具体代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">JNIEXPORT jstringJNICALL</span><br><span class="line">Java_com_zealens_face_jnitest_JniTest_getMsgFromJni(JNIEnv</span><br><span class="line">*env, jobject instance)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO</span></span><br><span class="line"><span class="keyword">return</span> (*env)-&gt;NewStringUTF(env, returnValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ol>
<li>对于第3行代码：<br>AS生成的代码有错误，需将JNICALL与前面的jstring隔开；</li>
<li>将returnValue修改为常量值（eg：”hello”）</li>
</ol>
</blockquote>
<p>至此，build之后调用API就能得到刚才填入的hello值。</p>
<hr>
<p>####新CMake</p>
<blockquote>
<p>AS现在默认的C++工具已经修改为CMake（需要在SDK-Tools中安装CMake、LLDB、NDK），旧的ndk-build库也可以手动导入</p>
</blockquote>
<blockquote>
<p>准备工作：</p>
<ol>
<li>如果有则移除：<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Remove this line</span></span><br><span class="line">android.useDeprecatedNdk = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<ol>
<li>install build tools</li>
</ol>
<p>（略：创建新的C++support Application）</p>
<ol>
<li>向现有项目添加C/C++ 代码：<br> a. 新建cpp目录；<br> b. 添加cpp文件，代码如下：</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span></span><br><span class="line">JNIEXPORT jstring JNICALL</span><br><span class="line">Java_%your test <span class="class"><span class="keyword">class</span> <span class="title">full</span> <span class="title">name</span>%_<span class="title">stringFromJNI</span>(</span></span><br><span class="line"><span class="class">        <span class="title">JNIEnv</span>* <span class="title">env</span>,</span></span><br><span class="line"><span class="class">        <span class="title">jobject</span> /* <span class="title">this</span> */) &#123;</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">"Hello from C++"</span>;</span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在欲链接cpp的根目录中（与build.gradle同级）创建文件：<code>CMakeLists.txt</code>，键入如下代码：（各API含义见<a href="https://developer.android.google.cn/studio/projects/add-native-code.html" target="_blank" rel="noopener">参考链接末尾部分</a>，或 <a href="https://cmake.org/cmake/help/latest/manual/cmake-commands.7.html" target="_blank" rel="noopener">CMake command</a>）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"># For more information about <span class="keyword">using</span> CMake with Android Studio, read the</span><br><span class="line"><span class="meta"># documentation: https:<span class="comment">//d.android.com/studio/projects/add-native-code.html</span></span></span><br><span class="line"></span><br><span class="line"># Sets the minimum version of CMake required to build the native library.</span><br><span class="line"></span><br><span class="line">cmake_minimum_required(VERSION <span class="number">3.4</span><span class="number">.1</span>)</span><br><span class="line"></span><br><span class="line"># Creates <span class="keyword">and</span> names a library, sets it as either STATIC</span><br><span class="line"><span class="meta"># or SHARED, and provides the relative paths to its source code.</span></span><br><span class="line"># You can define multiple libraries, <span class="keyword">and</span> CMake builds them <span class="keyword">for</span> you.</span><br><span class="line"># Gradle automatically packages shared libraries with your APK.</span><br><span class="line"></span><br><span class="line">add_library( # Sets the name of the library.</span><br><span class="line">             native-lib</span><br><span class="line"></span><br><span class="line">             # Sets the library as a shared library.</span><br><span class="line">             SHARED</span><br><span class="line"></span><br><span class="line">             # Provides a relative path to your source file(s).</span><br><span class="line">             src/main/cpp/native-lib.cpp )</span><br><span class="line"></span><br><span class="line"># Searches <span class="keyword">for</span> a specified prebuilt library <span class="keyword">and</span> stores the path as a</span><br><span class="line"><span class="meta"># variable. Because CMake includes system libraries in the search path by</span></span><br><span class="line"><span class="meta"># default, you only need to specify the name of the public NDK library</span></span><br><span class="line"><span class="meta"># you want to add. CMake verifies that the library exists before</span></span><br><span class="line"><span class="meta"># completing its build.</span></span><br><span class="line"></span><br><span class="line">find_library( # Sets the name of the path variable.</span><br><span class="line">              <span class="built_in">log</span>-lib</span><br><span class="line"></span><br><span class="line">              # Specifies the name of the NDK library that</span><br><span class="line">              # you want CMake to locate.</span><br><span class="line">              <span class="built_in">log</span> )</span><br><span class="line"></span><br><span class="line"># Specifies libraries CMake should link to your target library. You</span><br><span class="line"><span class="meta"># can link multiple libraries, such as libraries you <span class="meta-keyword">define</span> in this</span></span><br><span class="line"><span class="meta"># build script, prebuilt third-party libraries, or system libraries.</span></span><br><span class="line"></span><br><span class="line">target_link_libraries( # Specifies the target library.</span><br><span class="line">                       native-lib</span><br><span class="line"></span><br><span class="line">                       # Links the target library to the <span class="built_in">log</span> library</span><br><span class="line">                       # included in the NDK.</span><br><span class="line">                       $&#123;<span class="built_in">log</span>-lib&#125; )</span><br></pre></td></tr></table></figure>
<p>之后，在同一模块目录上单击右键，选择<code>link c++...</code>，选中欲链接的cpp文件，build.gradle就会生成如下代码：（android模块中）<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">externalNativeBuild &#123;</span><br><span class="line">    cmake &#123;</span><br><span class="line">        path <span class="string">"CMakeLists.txt"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>此时再调用相应API就可以看到效果了：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CppTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A native method that is implemented by the 'native-lib' native library,</span></span><br><span class="line"><span class="comment">     * which is packaged with this application.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNI</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Used to load the 'native-lib' library on application startup.</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"native-lib"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>pay attention to the lib name</p>
</blockquote>
<blockquote>
<p>高阶设置请参考手册，这里也只是介绍一个最小的CMake环境</p>
</blockquote>
<hr>
<p>关注公众号“夕识”，雕刻时光，雕刻思维<br><img src="http://upload-images.jianshu.io/upload_images/1481332-c461a8ddbf8cf08e.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AndroidStudio/">AndroidStudio</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JNI/">JNI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/QRCode/">QRCode</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-技术/Android/retrofit2"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/retrofit2/">retrofit2</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/retrofit2/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<blockquote>
<p>作者： <a href="https://twitter.com/jakewharton" target="_blank" rel="noopener">Jake Wharton</a></p>
<p>原文引自：<a href="https://academy.realm.io/cn/posts/droidcon-jake-wharton-simple-http-retrofit-2/" target="_blank" rel="noopener">link</a></p>
</blockquote>
<p><a href="http://square.github.io/retrofit/" target="_blank" rel="noopener">Retrofit</a> 作为简化 HTTP 请求的库，已经运行多年，2.0版本依然不辱使命的在做这些事情。不过 2.0 版本修复了一些长期影响开发者的设计，还加入了前所未有的强大特性。在 NYC 2015 的这一个分享中，<a href="https://twitter.com/jakewharton" target="_blank" rel="noopener">Jake Wharton</a> 的演讲涵盖了所有 Retrofit 2.0 的新特性，全面介绍了 Retrofit 2.0 工作原理。</p>
<hr>
<hr>
<p><em>Save the date for Droidcon SF in March — a conference with best-in-class presentations from leaders in all parts of the Android ecosystem.</em></p>
<hr>
<h3 id="简介-0-00"><a href="#简介-0-00" class="headerlink" title="简介 (0:00);)"></a>简介 <a href="javascript:presentz.changeChapter(0,0,true" target="_blank" rel="noopener">(0:00)</a>;)</h3><p>我叫 <a href="https://twitter.com/jakewharton" target="_blank" rel="noopener">Jake Wharton</a>，现在在 <a href="https://squareup.com/" target="_blank" rel="noopener">Square</a> 工作。一个天真的人曾经说过：”Retrofit 2 将会在今年年底前放出。”，那个人，就是去年在纽约 DroidCon 上表态的我。然而，事实是 Retrofit 2 <strong>将会在今年年底放出</strong>，这次我保证！</p>
<p><a href="http://square.github.io/retrofit/" target="_blank" rel="noopener">Retrofit</a> 5年前就开源了，是 Square 最早的开源项目之一。一开始的时候，Retrofit 只是我们用在各个开源项目里的福袋：比如说最早里面有晃动检测功能，HTTP Client，还有现在的 tap 库。多数功能都是 Bob Lee 完成的，我大概 3 年前开始接管这些工作。最终历经 3 年，完成了 1.0 版本，然后彻底开源。从那会儿到现在，已经 release 了 18 个版本了。</p>
<h3 id="Retrofit-1-不错的地方-2-23"><a href="#Retrofit-1-不错的地方-2-23" class="headerlink" title="Retrofit 1 不错的地方 (2:23);)"></a>Retrofit 1 不错的地方 <a href="javascript:presentz.changeChapter(0,11,true" target="_blank" rel="noopener">(2:23)</a>;)</h3><p>Retrofit 里已经有很多不错的特性了。Retrofit 可以利用接口，方法和注解参数（parameter annotations）来声明式定义一个请求应该如何被创建。比如说，下面是一个如何请求 GitHub API 的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  List&lt;Contributor&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Retrofit 背后的 HTTP client，以及序列化机制（JSON/XML 协议）都是可替换（pluggable）的，因此你可以选择合适自己的方案。Retrofit 最早出来的时候，只支持 Apache 的 HTTP client。在 1.0 放出前，我们增加了 URL connection，以及 OkHttp 的支持。如果你想要加入的其他的 HTTP client，都可以简单的加入。这个特性非常赞，让我们有能力去支持不同的自定义 client。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">builder.setClient(new UrlConnectionClient());</span><br><span class="line">builder.setClient(new ApacheClient());</span><br><span class="line">builder.setClient(new OkClient());</span><br><span class="line"></span><br><span class="line">builder.setClient(new CustomClient());</span><br></pre></td></tr></table></figure>
<p>序列化功能也是可替换的。默认是用的 GSON，你当然也可以用 Jackson 来替换掉。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  List&lt;Contributor&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">builder.setConverter(new GsonConverter());</span><br><span class="line">builder.setConverter(new JacksonConverter());</span><br></pre></td></tr></table></figure>
<p>如果你在用某些数据交换协议，比如 protocol buffer，Retrofit 也支持 Google 的 <a href="https://github.com/google/protobuf">protobuf</a>，也包括 XML 协议的转换（如果你自己不怕折腾）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  ContributorResponse repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">builder.setConverter(new ProtoConverter());</span><br><span class="line">builder.setConverter(new WireConverter());</span><br><span class="line"></span><br><span class="line">builder.setConverter(new SimpleXMLConverter());</span><br><span class="line"></span><br><span class="line">builder.setConverter(new CustomConverter());</span><br></pre></td></tr></table></figure>
<p>序列化部分跟 client 部分一样，都是可替换的。你如果想要引入或者实现自己的序列化组件，完全没有问题。</p>
<p>在发请求的实现上，你可以用的方法有很多，比如：同步发送请求——</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  List&lt;Contributor&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List&lt;Contributor&gt; contributors =</span><br><span class="line">    gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br></pre></td></tr></table></figure>
<p>——和异步发送，他们之间的区别就是异步发送要在最后一个参数上声明一个 callback 回调函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  void repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo,</span><br><span class="line">      Callback&lt;List&lt;Contributor&gt;&gt; cb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service.repoContributors(&quot;square&quot;, &quot;retrofit&quot;, new Callback&lt;List&lt;Contributor&gt;&gt;() &#123;</span><br><span class="line">  @Override void success(List&lt;Contributor&gt; contributors, Response response) &#123;</span><br><span class="line">    // ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override void failure(RetrofitError error) &#123;</span><br><span class="line">    // ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>——再到后来 1.0 后，我们还支持了 <a href="https://github.com/ReactiveX/RxJava">RxJava</a> ，被证明真的是个非常受欢迎的功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Observable&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;)</span><br><span class="line">    .subscribe(new Action1&lt;List&lt;Contributor&gt;&gt;() &#123;</span><br><span class="line">      @Override public void call(List&lt;Contributor&gt; contributors) &#123;</span><br><span class="line">        // ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Retrofit-1-不够好的地方-4-58"><a href="#Retrofit-1-不够好的地方-4-58" class="headerlink" title="Retrofit 1: 不够好的地方 (4:58);)"></a>Retrofit 1: 不够好的地方 <a href="javascript:presentz.changeChapter(0,28,true" target="_blank" rel="noopener">(4:58)</a>;)</h3><p>不幸的是，没有一个库是完美的，Retrofit 也不例外。为了支持可替换的功能模块，我们必须嵌套大量的组件，类的数量极多以至于成为了一个痛处，一方面是因为整个库非常的脆弱，还有就是因为我们无法修改公开的 API 接口。</p>
<p>Receive news and updates from Realm straight to your inbox</p>
<p>订阅Comments</p>
<p>如果你想要操作某次请求返回的数据，比如说返回的 Header 部分或者 URL，你又同时想要操作序列化后的数据部分，这是 Retrofit 1.0 上是不可能实现的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  List&lt;Contributor&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Response repoContributors2(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的这个 GitHub 的例子里，我们返回了一个 contributor 的列表，你可以用不同的 converter 去做反序列化。然而，如果说你要读取一个 reponse 的 header 部分。除非你设置一个 endpoint 来接管这个 reponse，不然你没有办法去读取这个 response。 由于 response header 数据里并没有反序列化后的对象，如果不做反序列化操作的话，那你也就无法拿到 contributor 对象了。</p>
<p>我刚才说过同步和异步，以及用起来非常棒的 RxJava，但是这些用起来却有些刻板。比如：我们在某些场景下既需要异步的调用，又需要同步的调用。在 Retrofit 1.0 里，你必须得声明两次这个方法，像下面这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  List&lt;Contributor&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  void repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo,</span><br><span class="line">      Callback&lt;List&lt;Contributor&gt;&gt; cb);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>RxJava 也有类似问题。但值得庆幸的是你在用 RxJava 的时候只用声明一次就行，为了实现这个，我们还在核心代码里增加了对 RxJava 的支持，以辅助返回 Observable 的对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Observable&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可能已经熟悉如何在 Retrofit 里创建 Observable 对象。但是如果你需要一些其他对象呢？ 比如，我们没有计划支持用了 Guava 的 ListenableFuture，以及那些用了 Java 8 的 CompleteableFuture。毕竟，Retrofit 1 是基于还在用着 Java 6 的 Android 开发的。</p>
<p>Retrofit 1 里 Converter 工作的效率并不算是很高。下面是在 Retrofit 1 里创建自定义 Converter 的代码，非常简单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface Converter &#123;</span><br><span class="line">  Object fromBody(TypedInput body, Type type);</span><br><span class="line">  TypedOutput toBody(Object object);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义 Converter 接收一个对象，然后返回一个格式化后的 HTTP 对象。问题是在我们传入了 Response 和一个我们想要转换的格式 Type 参数后，Converter 必须得搞清楚到底应该如何去反序列化，这部分的实现很复杂，而且耗时。尽管一些库做了对象的缓存，但依然效率很低。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/search/repositories&quot;)</span><br><span class="line">  RepositoriesResponse searchRepos(</span><br><span class="line">      @Query(&quot;q&quot;) String query,</span><br><span class="line">      @Query(&quot;since&quot;) Date since);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/search/repositories?q=retrofit&amp;since=2015-08-27</span><br><span class="line">/search/repositories?q=retrofit&amp;since=20150827</span><br></pre></td></tr></table></figure>
<p>有时候，声明式 API 会遇到一些小问题。比如就像上面的例子一样，你有个接口需要传入一个 Date，但是一个 Date 会有多种不同的格式表示。有的接口可能需要一个字符串，有的可能需要一个分隔开的日期表示（尤其是那些比日期要复杂很多的对象，可能会有更多的表示方法）。</p>
<p>以上，基本上就是 Retrofit 1 无力解决的需求了，我们要如何修复呢？</p>
<h3 id="Retrofit-2-10-18"><a href="#Retrofit-2-10-18" class="headerlink" title="Retrofit 2 (10:18);)"></a>Retrofit 2 <a href="javascript:presentz.changeChapter(0,48,true" target="_blank" rel="noopener">(10:18)</a>;)</h3><p>开发 Retrofit2 的时候，我们希望我们定位和解决所有大家多年以来在 Retrofit 1 里遇到的那些问题。</p>
<h4 id="Call-10-30"><a href="#Call-10-30" class="headerlink" title="Call (10:30);)"></a>Call <a href="javascript:presentz.changeChapter(0,49,true" target="_blank" rel="noopener">(10:30)</a>;)</h4><p>首先得提到的是：Retrofit2 有了新的类型。如果你熟悉用 OkHttp 做 API 请求，你可能比较熟悉其中的一个类：<code>Call</code>。现在， Retrofit 2 里也多了一个 <code>call</code> 方法。语法和 OkHttp 基本一模一样，唯一不同是这个函数知道如何做数据的反序列化。它知道如何将 HTTP 响应转换成对象。</p>
<p>另外，每一个 call 对象实例只能被用一次，所以说 request 和 response 都是一一对应的。你其实可以通过 <code>Clone</code> 方法来创建一个一模一样的实例，这个开销是很小的。比如说：你可以在每次决定发请求前 <code>clone</code> 一个之前的实例。</p>
<p>另一个大的进步是 2.0 同时支持了在一个类型中的同步和异步。同时，一个请求也可以被<strong>真正地</strong>终止。终止操作会对底层的 http client 执行 cancel 操作。即便是正在执行的请求，也能立即切断。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Call&lt;List&lt;Contributor&gt;&gt; call =</span><br><span class="line">    gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br></pre></td></tr></table></figure>
<p>这个 Call 对象是从你的 API 接口返回的参数化后的对象。调用跟接口名相同的函数名，你就会得到一个实例出来。我们可以直接调用它的 execute 方法，但是得留意一下，这个方法只能调用一次。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Call&lt;List&lt;Contributor&gt;&gt; call =</span><br><span class="line">    gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br><span class="line"></span><br><span class="line">response = call.execute();</span><br><span class="line"></span><br><span class="line">// This will throw IllegalStateException:</span><br><span class="line">response = call.execute();</span><br><span class="line"></span><br><span class="line">Call&lt;List&lt;Contributor&gt;&gt; call2 = call.clone();</span><br><span class="line">// This will not throw:</span><br><span class="line">response = call2.execute();</span><br></pre></td></tr></table></figure>
<p>当你尝试调用第二次的时候，就会出现失败的错误。实际上，可以直接克隆一个实例，代价非常低。当你想要多次请求一个接口的时候，直接用 clone 的方法来生产一个新的，相同的可用对象吧。</p>
<p>想要实现异步，需要调用 <code>enqueue</code> 方法。现在，我们就能通过一次声明实现同步和异步了！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Call&lt;List&lt;Contributor&gt;&gt; call =</span><br><span class="line">    gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br><span class="line"></span><br><span class="line">call.enqueue(new Callback&lt;List&lt;Contributor&gt;&gt;() &#123;</span><br><span class="line">  @Override void onResponse(/* ... */) &#123;</span><br><span class="line">    // ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override void onFailure(Throwable t) &#123;</span><br><span class="line">    // ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当你将一些异步请求压入队列后，甚至你在执行同步请求的时候，你可以随时调用 <code>cancel</code> 方法来取消请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Call&lt;List&lt;Contributor&gt;&gt; call =</span><br><span class="line">    gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br><span class="line"></span><br><span class="line">call.enqueue(         );</span><br><span class="line">// or...</span><br><span class="line">call.execute();</span><br><span class="line"></span><br><span class="line">// later...</span><br><span class="line">call.cancel();</span><br></pre></td></tr></table></figure>
<h4 id="Parameterized-Response-Object-13-48"><a href="#Parameterized-Response-Object-13-48" class="headerlink" title="Parameterized Response Object (13:48);)"></a>Parameterized Response Object <a href="javascript:presentz.changeChapter(0,68,true" target="_blank" rel="noopener">(13:48)</a>;)</h4><p>另一个新的特性是参数化的 Response 类型。 Response 对象增加了曾经一直被我们忽略掉的重要元数据：响应码（the reponse code），响应消息（the response message），以及读取相应头（headers）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Response&lt;T&gt; &#123;</span><br><span class="line">  int code();</span><br><span class="line">  String message();</span><br><span class="line">  Headers headers();</span><br><span class="line"></span><br><span class="line">  boolean isSuccess();</span><br><span class="line">  T body();</span><br><span class="line">  ResponseBody errorBody();</span><br><span class="line">  com.squareup.okhttp.Response raw();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时还提供了一个很方便的函数来帮助你判断请求是否成功完成，其实就是检查了下响应码是不是 200。然后就拿到了响应的 body 部分，另外有一个单独的方法获取 error body。基本上就是出现一个返回码，然后调用相对应的函数的。只有当响应成功以后，我们会去做反序列化操作，然后将反序列化的结果放到 body 回调中去。如果出现了返回了网络成功响应（返回码：200）却最终返回 false 的情况，我们实际上是无法判断返回到底是什么的，只能将 <code>ResponseBody</code>（简单封装的了 content-type，length，以及 raw body部分） 类型交给你去处理。</p>
<p>以上是在声明接口时候的两个重大的改变。</p>
<h4 id="动态-URL-Parameter-16-33"><a href="#动态-URL-Parameter-16-33" class="headerlink" title="动态 URL Parameter (16:33);)"></a>动态 URL Parameter <a href="javascript:presentz.changeChapter(0,101,true" target="_blank" rel="noopener">(16:33)</a>;)</h4><p>动态 URL 参数是让我头疼多年的一个问题，现在我们终于解决了！如果你向 GitHub 发出多个请求，收到一个响应，通常这个响应大概像下面这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Call&lt;List&lt;Contributor&gt;&gt; call =</span><br><span class="line">    gitHubService.repoContributors(&quot;square&quot;, &quot;retrofit&quot;);</span><br><span class="line">Response&lt;List&lt;Contributor&gt;&gt; response = call.execute();</span><br><span class="line"></span><br><span class="line">// HTTP/1.1 200 OK</span><br><span class="line">// Link: &lt;https://api.github.com/repositories/892275/contributors?</span><br><span class="line">page=2&gt;; rel=&quot;next&quot;, &lt;https://api.github.com/repositories/892275/</span><br><span class="line">contributors?page=3&gt;; rel=&quot;last&quot;</span><br><span class="line">// ...</span><br></pre></td></tr></table></figure>
<p>要是你想做分页，你就得自己去分析这些 URL 了。GitHub 可能将 header link 地址列表里的数据已经缓存在服务器内存里了，当你去按他们指引的地址去请求的话，他们就不必费劲去从数据库里给你拿数据了，速度上也更快。但是，在 Retrofit 1.0 的时候，我们没有办法去直接执行 GitHub Server 返回在 header 里的请求地址。</p>
<p>用上我们新的 response 类型后，不止是我刚才提到的那些元数据，我们还可以写一些方法来读出自定义的字段，比如上面例子里的下一页的地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Response&lt;List&lt;Contributor&gt;&gt; response = call.execute();</span><br><span class="line"></span><br><span class="line">// HTTP/1.1 200 OK</span><br><span class="line">// Link: &lt;https://api.github.com/repositories/892275/contributors?</span><br><span class="line">page=2&gt;; rel=&quot;next&quot;, &lt;https://api.github.com/repositories/892275/</span><br><span class="line">contributors?page=3&gt;; rel=&quot;last&quot;</span><br><span class="line">// ...</span><br><span class="line"></span><br><span class="line">String links = response.headers().get(&quot;Link&quot;);</span><br><span class="line">String nextLink = nextFromGitHubLinks(links);</span><br><span class="line"></span><br><span class="line">// https://api.github.com/repositories/892275/contributors?page=2</span><br></pre></td></tr></table></figure>
<p>这个可能和上面的接口生成地址略有不同。</p>
<p>动态 URL 地址就是用在连续请求里的。在第一个请求之后，如果返回的结果里有指明下个请求的地址的话，在之前，你可能得单独写个 interface 来处理这种情况，现在就无需那么费事了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line"></span><br><span class="line">  @GET</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributorsPaginate(</span><br><span class="line">      @Url String url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Retrofit 2.0 有了新的 标注：<code>@Url</code> ，允许你直接传入一个请求的 URL。</p>
<p>有了这个方法后，我们就可以直接把刚才取出来的下一页的地址传入，是不是一切都流畅了很多：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String nextLink = nextFromGitHubLinks(links);</span><br><span class="line"></span><br><span class="line">// https://api.github.com/repositories/892275/contributors?page=2</span><br><span class="line"></span><br><span class="line">Call&lt;List&lt;Contributor&gt;&gt; nextCall =</span><br><span class="line">    gitHubService.repoContributorsPaginate(nextLink);</span><br></pre></td></tr></table></figure>
<p>这样的话，我们就能通过调用 <code>repoContributorsPaginate</code> 来获取第二页内容，然后通过第二页的 header 来请求第三页。你可能很多的 API 都见到过类似的设计，这在 Retrofit 1 里确实是个困扰很多人的大麻烦。</p>
<h4 id="更多更有效的-Converters-19-31"><a href="#更多更有效的-Converters-19-31" class="headerlink" title="更多更有效的 Converters (19:31);)"></a>更多更有效的 Converters <a href="javascript:presentz.changeChapter(0,113,true" target="_blank" rel="noopener">(19:31)</a>;)</h4><p>Retrofit 1 里有一个 converter 的问题。多数人可能没遇到过，是库内部的一个问题。在 Retrofit 2 里，我们已经解决了这个问题，同时开始支持多种 Converter 并存。</p>
<p>在之前，如果你遇到这种情况：一个 API 请求返回的结果需要通过 JSON 反序列化，另一个 API 请求需要通过 proto 反序列化，唯一的解决方案就是将两个接口分离开声明。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface SomeProtoService &#123;</span><br><span class="line">  @GET(&quot;/some/proto/endpoint&quot;)</span><br><span class="line">  Call&lt;SomeProtoResponse&gt; someProtoEndpoint();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface SomeJsonService &#123;</span><br><span class="line">  @GET(&quot;/some/json/endpoint&quot;)</span><br><span class="line">  Call&lt;SomeJsonResponse&gt; someJsonEndpoint();</span><br></pre></td></tr></table></figure>
<p>之所以搞得这么麻烦是因为一个 REST adapter 只能绑定一个 Converter 对象。我们费工夫去解决这个是因为：接口的声明是要语意化的。API 接口应该通过功能实现分组，比如： account 的接口，user 的接口，或者 Twitter 相关的接口。返回格式的差异不应该成为你分组时候的阻碍。</p>
<p>现在，你可以把他们都放在一起了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">interface SomeService &#123;</span><br><span class="line">  @GET(&quot;/some/proto/endpoint&quot;)</span><br><span class="line">  Call&lt;SomeProtoResponse&gt; someProtoEndpoint();</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/some/json/endpoint&quot;)</span><br><span class="line">  Call&lt;SomeJsonResponse&gt; someJsonEndpoint();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我大概提一下这个是怎么工作起来的，因为了解 Converter 的调用原理在写代码的时候很重要。</p>
<p>看我们上面的代码：第一个方法返回了一个 proto 对象。</p>
<p><code>SomeProtoResponse</code> —&gt; Proto? <strong>Yes!</strong></p>
<p>原理很简单，其实就是对着每一个 converter 询问他们是否能够处理某种类型。我们问 proto 的 converter： “Hi, 你能处理 <code>SomeProtoResponse</code> 吗？”，然后它尽可能的去判断它是否可以处理这种类型。我们都知道：Protobuff 都是从一个名叫 message 或者 message lite 的类继承而来。所以，判断方法通常就是检查这个类是否继承自 message。</p>
<p>在面对 JSON 类型的时候，首先问 proto converter，proto converter 会发现这个不是继承子 Message 的，然后回复 no。紧接着移到下一个 JSON converter 上。JSON Converter 会回复说我可以！</p>
<p><code>SomeJsonResponse</code> —&gt; Proto? <strong>No!</strong> —&gt; JSON? <strong>Yes!</strong></p>
<p>因为 JSON 并没有什么继承上的约束。所以我们无法通过什么确切的条件来判断一个对象是否是 JSON 对象。以至于 JSON 的 converters 会对任何数据都回复说：我可以处理！这个一定要记住， JSON converter 一定要放在最后，不然会和你的预期不符。</p>
<p>另一个要注意的是，现在已经不提供默认的 converter 了。如果不显性的声明一个可用的 Converter 的话，Retrofit 是会报错的：提醒你没有可用的 Converter。因为核心代码已经不依赖序列化相关的第三方库了，我们依然提供对 Converter 的支持，不过你需要自己引入这些依赖，同时显性的声明 Retrofit 需要用的 Converter 有哪些。</p>
<h4 id="更多可替换的执行机制-22-38"><a href="#更多可替换的执行机制-22-38" class="headerlink" title="更多可替换的执行机制 (22:38);)"></a>更多可替换的执行机制 <a href="javascript:presentz.changeChapter(0,121,true" target="_blank" rel="noopener">(22:38)</a>;)</h4><p>在此之前，Retrofit 有一个死板的 execution 流程。在 Retrofit 2 里，我们调整了整个流程，让它变得可替换（pluggable），同时允许多个。跟 converter 的工作原理很像。</p>
<p>比如说，你有一个方法返回了一个 Call 对象，Call 是内置的 Converter 类型。比如：Retrofit 2　的执行机制：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>现在，你可以自定义这些了。或者用我们提供的一个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Observable&lt;List&lt;Contributor&gt;&gt; repoContributors2(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Future&lt;List&lt;Contributor&gt;&gt; repoContributors3(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Retrofit 2.0 依然支持 RxJava，但现在是分离的。（你如果想要一些别的特性，你也可以自己写一个）同时支持不同的 execution 是怎么实现的呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(..);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Observable&lt;List&lt;Contributor&gt;&gt; repoContributors2(..);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Future&lt;List&lt;Contributor&gt;&gt; repoContributors3(..);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过返回类型来判断需要调用哪个 exection。比如说：返回为 Call 的类型， 我们的整个执行机制会问：“Hey，你知不知道如何处理 Call ？”　如果是 RxJava，它就会说：“我不知道，我只知道　Observable 的处理方法。”。　随后，我们又问内部的 converter，他刚好回答说：“是的！我会！”。</p>
<p><code>call</code> —&gt; RxJava? <strong>No!</strong> —&gt; Call? <strong>Yes!</strong></p>
<p>Observable 也是同样的工作原理。我们同样问 RxJava，它就说：“我能处理这个”：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(..);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Observable&lt;List&lt;Contributor&gt;&gt; repoContributors2(..);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Future&lt;List&lt;Contributor&gt;&gt; repoContributors3(..);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Observable —&gt; RxJava? <strong>Yes!</strong></p>
<p>如果你没装相对应的 Converter，这就意味着我们无法验证响应的类型。比如：如果询问是否有办法能处理　Future，他们两个都会说：“不行”。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(..);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Observable&lt;List&lt;Contributor&gt;&gt; repoContributors2(..);</span><br><span class="line"></span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Future&lt;List&lt;Contributor&gt;&gt; repoContributors3(..);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Future —&gt; RxJava? <strong>No!</strong> —&gt; Call? <strong>No!</strong> —&gt; Throw!</p>
<p>这将会返回一个 Exception，意味着这两个以及内置的机制都无法处理这种类型。关于工作原理我们随后会深入讨论。</p>
<h3 id="OkHttp-提供支持-24-17"><a href="#OkHttp-提供支持-24-17" class="headerlink" title="OkHttp 提供支持 (24:17);)."></a>OkHttp 提供支持 <a href="javascript:presentz.changeChapter(0,135,true" target="_blank" rel="noopener">(24:17)</a>;).</h3><p>Retrofit 2 现在开始依赖了 OkHttp 了，而且这部分不再支持替换。这是一件比较有争议的事情。但是希望我能证明为什么这是一个对的决定。</p>
<p>OkHttp 现在很小而且很聚焦，有很多好用的 API 接口。我们在 Retrofit 2 里都有对 OkHttp 的接口映射，也基本具备了我们需要的所有的特性，包括提到的所有的抽象类们。这些都超赞！这是压缩 Retrofit 库大小的一个法宝。我们最终减小了Retrofit 60% 的体积，同时又具有了更多的特性。</p>
<h3 id="OkHttp-提供支持-以及-Okio-26-20"><a href="#OkHttp-提供支持-以及-Okio-26-20" class="headerlink" title="OkHttp 提供支持 (以及 Okio!) (26:20);)"></a>OkHttp 提供支持 (以及 Okio!) <a href="javascript:presentz.changeChapter(0,141,true" target="_blank" rel="noopener">(26:20)</a>;)</h3><p>另一个用 OkHttp 的好处就是我们能够在 Retrofit 2 把 OkHttp 以公开接口的方式直接导出。你可能在 error body 方法或者响应里见到过 response body 的内容。显然，我们在 Retrofit 的 Reponse 对象里直接返回了 OkHttp 的 Response body。我们正在导出这些类型，OkHttp 的类型基本上已经以更好更简洁的 API 替代 Retrofit 1.0 的一些接口。</p>
<p>OkHttp 的背后是一个叫做 Okio 的库，提供的 IO 支持。我之前在 <a href="https://youtu.be/WvyScM_S88c" target="_blank" rel="noopener">Droidcon Montreal</a> 做过关于这个库的演讲。讨论过为什么它是众多 IO 库中更好的选择，还讨论了它为何极度高效，以及为什么你应该使用它们。演讲中我还提到 Retrofit 2 ，当时它还是脑海里的一个概念。现在 Retrofit 2 已经实现了。</p>
<h3 id="Retrofit-2-的效率-27-31"><a href="#Retrofit-2-的效率-27-31" class="headerlink" title="Retrofit 2 的效率 (27:31);)"></a>Retrofit 2 的效率 <a href="javascript:presentz.changeChapter(0,142,true" target="_blank" rel="noopener">(27:31)</a>;)</h3><p>我做了这个图表来展示 Retrofit 相比 Retrofit 1 以及其他可能的方案要高效的多，这归功于刚刚提到的硬性依赖和那些抽象。我带大家来看一下上面视频中的这个表。所以一定要看我演讲的这<a href="javascript:presentz.changeChapter(0,142,true" target="_blank" rel="noopener">部分</a>;)噢！</p>
<h3 id="初始化-Retrofit-类型-31-24"><a href="#初始化-Retrofit-类型-31-24" class="headerlink" title="初始化 - Retrofit 类型 (31:24);)"></a>初始化 - Retrofit 类型 <a href="javascript:presentz.changeChapter(0,164,true" target="_blank" rel="noopener">(31:24)</a>;)</h3><p>现在，让我们来看一下 Retrofit 的类型是如何替代 REST adapter 类型的，以及如何初始化。原来的方法叫做 <code>endpoint</code>, 不过现在我们称之为 <code>baseUrl</code>, <code>baseUrl</code> 就是你所请求的 Server 的 URL，下面是一个请求 GitHub Api 的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GitHubService gitHubService = retrofit.create(GitHubService.class);</span><br></pre></td></tr></table></figure>
<p>我们声明了自己的接口，我们称作创建方法，跟 Retrofit 1 里的是一致的。接下来，我们来生成一个接口的实现，以使这些接口方法可以直接被调用。</p>
<p>当我们调用 <code>repoContributors</code> 这个方法的时候，Retrofit 会创建这个 URL。如果我们传入 <code>Square</code> 和 <code>Retrofit</code> 字符串，分别作为 <code>owner</code> 和 <code>repo</code> 参数。我们就会得到这个 URL：<code>https://api.github.com/repos/square/retrofit/contributors</code>。在 Retrofit 内部，Retrofit 会用 OkHttp 的 HTTP URL 类型作为 基础的 URL ，然后 <code>resolve</code> 方法就会取出相对地址和 baseUrl 拼接起来，接着发起请求。接下来给你展示下改变 API 前缀，比如 V3。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com/v3/&quot;)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>虽然说这不是 GitHub 真实的 API，但是真实世界里就是有很多 API 是由这样的前缀和路径组成的。调用相同的方法，被解析出来的 URL 将会是是这样的： <code>https://api.github.com/repos/square/retrofit/contributors</code>。可以看到在主机地址之后并没有<code>v3</code> ，这是因为地址的 URL 是以一个斜线开始的，而在 HTTP 里，斜线开始的地址往往是绝对地址后缀路径。Retrofit 1 会因为语义化的约束，强制你加这个前缀斜线, 然后把 baseUrl 和相对地址拼接起来。现在，考虑到规范问题，我们已经对这两种地址加以区分。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果有前缀 <code>/</code> 就代表着是一个绝对路径。删除了那个前缀的 <code>/</code>， 你将会得到正确的、包含了 <code>v3</code> 路径的全 URL。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com/v3/&quot;)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">interface GitHubService &#123;</span><br><span class="line">  @GET(&quot;repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br><span class="line">  Call&lt;List&lt;Contributor&gt;&gt; repoContributors(</span><br><span class="line">      @Path(&quot;owner&quot;) String owner,</span><br><span class="line">      @Path(&quot;repo&quot;) String repo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// https://api.github.com/v3/repos/square/retrofit/contributors</span><br></pre></td></tr></table></figure>
<p>由于现在我们开始依赖 OkHttp， 并没有 Http Client 层的抽象。现在是可以传递一个配置好的 OkHttp 实例的。比如：配置 interceptors, 或者一个 SSL socket 工厂类， 或者 timeouts 的具体数值。 （OkHttp 有默认的超时机制，如果你不需要自定义，实际上不必进行任何设置，但是如果你想要去设置它们，下面是一个例子告诉你来怎么操作。）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient client = new OkHttpClient();</span><br><span class="line">client.interceptors().add(..);</span><br><span class="line"></span><br><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class="line">    .client(client)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<p>如果你要指明特定的 converter 或者 execute 机制，也是在这个时候加的。比如这会儿：我们可以给 GSON 设置一个或者多个 converter。也可以给 protocol buffer 设置一个 converter。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class="line">    .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">    .addConverterFactory(ProtoConverterFactory.create())</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<p>我想要强调的是：<strong>添加 converter 的顺序很重要</strong>。按照这个顺序，我们将依次询问每一个 converter 能否处理一个类型。我上面写的其实是错的。如果我们试图反序列化一个 proto 格式，它其实会被当做 JSON 来对待。这显然不是我们想要的。我们需要调整下顺序，因为我们先要检查 proto buffer 格式，然后才是 JSON。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class="line">    .addConverterFactory(ProtoConverterFactory.create())</span><br><span class="line">    .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<p>Retrofit 的文档里可能还没这些，如果你想要使用 RxJava 来代替 call, 你需要一个 Call Adapter Factory:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">    .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class="line">    .addConverterFactory(ProtoConverterFactory.create())</span><br><span class="line">    .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">    .addCallAdapterFactory(RxJavaCallAdapterFactory.create())</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<p>Call Adapter Factory 是一个知道如何将 call 实例转换成其他类型的工厂类。目前，我们只有 RxJava 的类型，也就是将 Call 类型转换成 Observable 类型。如果你了解 RxJava, 其实还有一种新的 Observable 类型（一次只发射一个 item 的类型）。你可以用这个 call adapter factory 来转换到其中任意一种 Observable。</p>
<h3 id="扩展性-36-50"><a href="#扩展性-36-50" class="headerlink" title="扩展性 (36:50);)"></a>扩展性 <a href="javascript:presentz.changeChapter(0,187,true" target="_blank" rel="noopener">(36:50)</a>;)</h3><p>刚才提到的 Factory，也是可扩展的。这意味着你可以写属于自己的 Call Adapter Facotry。实现起来其实就是一个方法。传递给它一个类型，返回 null 代表拒绝，或者返回一个 converter 的实例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SomeJsonResponse</span><br><span class="line"></span><br><span class="line">		class ProtoConverterFactory &#123;</span><br><span class="line">  			Converter&lt;?&gt; create(Type type);		null</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		class GsonConverterFactory &#123;</span><br><span class="line">			Converter&lt;?&gt; create(Type type);		Converter&lt;?&gt;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p>看上面的例子，如果你给它传递一个 JSON 的 Respnose 类型，这个类型不是从 proto 继承而来，那么它就会说：”我不知道如何传递这个，所以我返回空值 null.』，然而，对于 GSON converter 而言，它通过返回一个实例来表明它可以处理这个类型的。这就是为什么这个类是一个工厂类，因为我们让它生产 converter 实例。</p>
<p>如果你想要做一些自定义，实现起来是非常容易的。Converter 的实现与之前的实现是非常相似的，尽管代替类型化的输入和输出，我们现在使用的是 OkHttp 的请求body 和相应 body。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface Converter&lt;T&gt; &#123;</span><br><span class="line">  interface Factory &#123;</span><br><span class="line">	Converter &lt;?&gt; create(Type type);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  T fromBody(ResponseBody body);</span><br><span class="line">  RequestBody toBody(T value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在这已经高效的多，因为我们实际上可以查询那些 adapter。举个例子，GSON 有一个type adapter, 当我们请求 GSON Converter Factory，询问它是否可以处理某种请求的时候， converter factory 就开始查询这个 adapter, 它将以缓存的形式存在，当我们再次查询的时候，这个 adapter 就可以直接被使用了。这是一个非常小的成功，极力避免了不断地查询带来的损耗。</p>
<p>call adapter 有相同的模式。我们询问一个 call adapter factory 它是否可以处理某个类型，它将会以相同的方式回应。（例如：它会返回 null 来表达否）。它的API 是非常简单的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface CallAdapter&lt;T&gt; &#123;</span><br><span class="line">  interface Factory &#123;</span><br><span class="line">    CallAdapter&lt;?&gt; create(Type type);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Type responseType();</span><br><span class="line">  Object adapt(Call&lt;T&gt; value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们有一个方法来来实现适配。传入一个 call 实例，返回了一个 observable，single 或者 future 等。 还有一种方法来获得这种 response 类型：当我们声明一系列 contributor 调用时， 我们没法自动把那些参数化的类型提取出来，因此我们基本上只是请求这个 call adapter 也返回这个 response type。如果你为这个变量创造了一个实例，我们会请求 call adapter, 它会将 contributor type 列表返回。</p>
<h3 id="还在建设中-40-05"><a href="#还在建设中-40-05" class="headerlink" title="还在建设中 (40:05);)"></a>还在建设中 <a href="javascript:presentz.changeChapter(0,204,true" target="_blank" rel="noopener">(40:05)</a>;)</h3><p>Retrofit 2 正在完善中！现在还不够完整，但是已经可以用了。我上面提到的点都是已经完成了的，那还有哪些未完成呢？</p>
<p>关于所谓的“参数 handler”我们现在还没有一个成熟的想法。我们未来想要让它有从 Guava 传递多个 map，或者数据类型及枚举类型。</p>
<p>日志功能还没有完成，在 Retrofit 1 里是有日志的，但是在 Retrofit 2 里面没有。依赖 OkHttp 的一个优点是你实际上可以使用一个 interceptor 来实现实际的底层的请求和响应日志。因此，对于原始请求和响应，我们并不需要它，但是我们很可能需要日志来记录 Java 类型。</p>
<p>如果你曾经使用过 mock 模块，你会发现它也还没被完成，但很快会完成的。</p>
<p>现在文档依然比较缺。</p>
<p>最后，在我有空的时候，我想在 Retrofit 2 里支持 WebSocket。在 2.0 里很可能无法实现，但是我想在后续的2.1 版本里会加入支持。</p>
<h3 id="Release-41-31"><a href="#Release-41-31" class="headerlink" title="Release? (41:31);)"></a>Release? <a href="javascript:presentz.changeChapter(0,210,true" target="_blank" rel="noopener">(41:31)</a>;)</h3><p>我保证过 Retrofit 2 今年会和大家见面，今年确实可以。至于具体哪天问世，我们不会做任何承诺。我不想再在 2016 的 DroidCons 上开相同的玩笑。因此今年一定会问世。我保证。至于2015年8月27日，我已经开放了一个2.0的测试版。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  compile &apos;com.squareup.retrofit:retrofit:2.0.0-beta1&apos;</span><br><span class="line">  compile &apos;com.squareup.retrofit:converter-gson:2.0.0-beta1&apos;</span><br><span class="line">  compile &apos;com.squareup.retrofit:adapter-rxjava:2.0.0-beta1&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可以依赖它。它已经可以正常工作了，API 接口也相对稳定。Converter 和 converter 工厂方法未来可能会改变，但是总体来说是有用的。要是你有什么不喜欢或者有问题的地方，请联系我！谢谢！</p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/retrofit/">retrofit</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-技术/Android/【Android】AS-依赖lib建议、微信QRCode登陆"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/【Android】AS-依赖lib建议、微信QRCode登陆/">AndroidAS-依赖lib建议、微信QRCode登陆</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/【Android】AS-依赖lib建议、微信QRCode登陆/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>只有一条：<br>能download lib就download之后放到libs dir吧，不然伙伴们sync起来太费时间了；</p>
</blockquote>
<blockquote>
<p>这样的话，注意定期检查各lib版本就好</p>
</blockquote>
<p>今日入坑：微信登陆（扫描二维码登陆）<br><a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419317851&amp;token=&amp;lang=zh_CN" target="_blank" rel="noopener">参考链接：官方API doc</a></p>
<p>总结一下步骤：</p>
<ol>
<li>获取二维码（QRCode）</li>
<li>用户授权后，重定向接口会接受到带code的请求<code>--&gt;code [get]</code></li>
<li><p>拿着上一步的<code>code</code>，连带在微信注册时的appid、secret一起去请求access_token <code>--&gt;access_token、openid[get]</code></p>
</li>
<li><p><strong>大功告成</strong>：拿着上一步得到的token跟openid，就可以请求你想要的数据啦</p>
</li>
</ol>
<p>时序图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1481332-c7db4bd0ffa26d19.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="wechat.png"></p>
<hr>
<p>关注公众号“夕识”，雕刻时光，雕刻思维<br><img src="http://upload-images.jianshu.io/upload_images/1481332-c461a8ddbf8cf08e.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AndroidStudio/">AndroidStudio</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-技术/Android/【Android Tool】内存快照分析，自动抓取dump文件并转换脚本"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/【Android Tool】内存快照分析，自动抓取dump文件并转换脚本/">【Android Tool】内存快照分析，自动抓取dump文件并转换脚本</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/【Android Tool】内存快照分析，自动抓取dump文件并转换脚本/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>最新得到的Google内部消息，未来谷歌应用商店的排名算法将会把App的性能纳入考量范围（使用的机器学习算法），我们开发者也应该将性能这一指标纳入自己的检查范围</p>
</blockquote>
<h2 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h2><p>解决抓取内存文件，拉取到电脑，新建文件夹，转换为Eclipse Memory Analyzer 文件操作繁琐的问题</p>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ul>
<li>clone项目之后，上述流程只需要👇的指令即可完成</li>
<li>自动将转换的文件存档到新建的同名目录下，避免MAT分析产生的临时文件污染文档目录</li>
<li>更改目录或进程时，无需修改配置文件，输入即可自动记录上次操作习惯</li>
<li>重复输入名称时，会自动append 时间到原来名称，避免覆盖历史文件</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python GrabDump.py</span><br></pre></td></tr></table></figure>
<p>读完本文，你将收获到一个自动化上述流程的简单project</p>
<blockquote>
<p>需要了解 Apk包的内存占用各部分组成</p>
</blockquote>
<h3 id="GitHub-地址"><a href="#GitHub-地址" class="headerlink" title="GitHub 地址"></a>GitHub 地址</h3><p><a href="https://github.com/KyleCe/PhonePerformanceMeasure">https://github.com/KyleCe/PhonePerformanceMeasure</a></p>
<h2 id="关键点"><a href="#关键点" class="headerlink" title="关键点"></a>关键点</h2><p>最终的使用时样式：</p>
<p><img src="../../pic_resource/grabDump.png" alt=""></p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ul>
<li>首先你需要安装Python ^_^</li>
</ul>
<ul>
<li>可以输入的参数包括：  dump文件名、存放目录、需要抓取的进程名</li>
<li>下次输入时，如果没有完全输入，会自动使用上一次的参数</li>
</ul>
<blockquote>
<p>第一次输入的时候还是需要完全的配置</p>
</blockquote>
<h3 id="已知问题"><a href="#已知问题" class="headerlink" title="已知问题"></a>已知问题</h3><p>抓取dump次数过多时会出现adb缓存读写错误的问题，需要重启adb（kill-server | start-server），后续找到解决方案会及时更新到Github repository</p>
<hr>
<p>扫描二维码，关注“夕识”，一起学习Android知识、CS知识，努力成为一位  different thinker</p>
<p><img src="../../pic_resource/qrcode_for_wechat.jpg" alt=""></p>
<p>点击“链接”，跳转至repo地址</p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Dump/">Dump</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MemoryLeak/">MemoryLeak</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-技术/Android/GL Launcher memory consume test report"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/GL Launcher memory consume test report/">GL exampleModule memory consume test report</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/GL Launcher memory consume test report/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="“GL”-test部分模块-内存占用测试"><a href="#“GL”-test部分模块-内存占用测试" class="headerlink" title="“GL”  test部分模块 内存占用测试"></a>“GL”  test部分模块 内存占用测试</h1><blockquote>
<p>trunk 3.0 #90770</p>
<p>测试机型：N5 6.0</p>
</blockquote>
<h3 id="dump场景："><a href="#dump场景：" class="headerlink" title="dump场景："></a>dump场景：</h3><ol>
<li>正常运行——静置3min</li>
<li>进入负一屏</li>
<li>进入3D时钟</li>
<li>进入AllApps</li>
<li>进入天气</li>
<li>进入搜索</li>
<li>应用3D主题之后</li>
<li>3D主题关屏之后</li>
<li>从3D切回2D</li>
</ol>
<h2 id="测试结论"><a href="#测试结论" class="headerlink" title="测试结论"></a>测试结论</h2><blockquote>
<p>以下结论基于N5 6.0机型，结果未与其它机器、安卓版本做横向比较</p>
</blockquote>
<ul>
<li>test进程内，各模块切换时未出现太大波动</li>
<li>但test起始值（Gfx dev）在 40000KB（~40M）左右，考虑这一点是否有改进必要、空间？</li>
<li>3D主题相较2D，内存占用升高~17M左右（具体值未严格测试）</li>
<li>关屏之后（静置&gt;2min），未对内存占用做优化处理——考虑是否可行？是否必要？？？</li>
<li>从3D切回2D，内存反增11M左右（对此dump文件感兴趣的同学联系我）——此处需要分析hprof，找到问题点</li>
</ul>
<h2 id="实验数据"><a href="#实验数据" class="headerlink" title="实验数据"></a>实验数据</h2><h3 id="正常运行——静置3min"><a href="#正常运行——静置3min" class="headerlink" title="正常运行——静置3min"></a>正常运行——静置3min</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">16257</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">25108</span>    <span class="number">25080</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">43264</span>    <span class="number">36859</span>     <span class="number">6404</span></span><br><span class="line">  Dalvik Heap    <span class="number">42114</span>    <span class="number">42040</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">65438</span>    <span class="number">50717</span>    <span class="number">14721</span></span><br><span class="line"> Dalvik Other     <span class="number">3860</span>     <span class="number">3860</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1516</span>     <span class="number">1516</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">176</span>      <span class="number">140</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">41004</span>    <span class="number">41004</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev      <span class="number">136</span>        <span class="number">0</span>      <span class="number">136</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">8610</span>      <span class="number">320</span>      <span class="number">812</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">2555</span>        <span class="number">0</span>     <span class="number">2100</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">173</span>        <span class="number">0</span>      <span class="number">128</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">29908</span>       <span class="number">48</span>    <span class="number">23812</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">2767</span>        <span class="number">0</span>      <span class="number">900</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">1705</span>     <span class="number">1528</span>        <span class="number">4</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1078</span>        <span class="number">8</span>      <span class="number">608</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">44880</span>    <span class="number">44880</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">4924</span>     <span class="number">4924</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">210514</span>   <span class="number">165348</span>    <span class="number">28500</span>        <span class="number">0</span>   <span class="number">108702</span>    <span class="number">87576</span>    <span class="number">21125</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">43572</span></span><br><span class="line">         Native Heap:    <span class="number">25080</span></span><br><span class="line">                Code:    <span class="number">28120</span></span><br><span class="line">               Stack:     <span class="number">1516</span></span><br><span class="line">            Graphics:    <span class="number">85884</span></span><br><span class="line">       Private Other:     <span class="number">9676</span></span><br><span class="line">              System:    <span class="number">16666</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">210514</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="进入负一屏"><a href="#进入负一屏" class="headerlink" title="进入负一屏"></a>进入负一屏</h3><blockquote>
<p>未点击触发任何动画</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">16257</span> [com..test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">25583</span>    <span class="number">25548</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">43264</span>    <span class="number">37267</span>     <span class="number">5996</span></span><br><span class="line">  Dalvik Heap    <span class="number">45619</span>    <span class="number">45532</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">65017</span>    <span class="number">57890</span>     <span class="number">7127</span></span><br><span class="line"> Dalvik Other     <span class="number">3900</span>     <span class="number">3900</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1520</span>     <span class="number">1520</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">176</span>      <span class="number">140</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">42456</span>    <span class="number">42456</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev      <span class="number">136</span>        <span class="number">0</span>      <span class="number">136</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">9323</span>      <span class="number">320</span>      <span class="number">960</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">2583</span>        <span class="number">0</span>     <span class="number">2104</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">173</span>        <span class="number">0</span>      <span class="number">128</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">30308</span>       <span class="number">48</span>    <span class="number">24112</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">3297</span>        <span class="number">0</span>     <span class="number">1284</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">2015</span>     <span class="number">1540</span>      <span class="number">272</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1223</span>        <span class="number">8</span>      <span class="number">696</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">53520</span>    <span class="number">53520</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">4924</span>     <span class="number">4924</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">226756</span>   <span class="number">179456</span>    <span class="number">29692</span>        <span class="number">0</span>   <span class="number">108281</span>    <span class="number">95157</span>    <span class="number">13123</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">47344</span></span><br><span class="line">         Native Heap:    <span class="number">25548</span></span><br><span class="line">                Code:    <span class="number">28956</span></span><br><span class="line">               Stack:     <span class="number">1520</span></span><br><span class="line">            Graphics:    <span class="number">95976</span></span><br><span class="line">       Private Other:     <span class="number">9804</span></span><br><span class="line">              System:    <span class="number">17608</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">226756</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="进入3D时钟"><a href="#进入3D时钟" class="headerlink" title="进入3D时钟"></a>进入3D时钟</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">16257</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">25243</span>    <span class="number">25216</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">43776</span>    <span class="number">36699</span>     <span class="number">7076</span></span><br><span class="line">  Dalvik Heap    <span class="number">42553</span>    <span class="number">42480</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">66333</span>    <span class="number">50306</span>    <span class="number">16027</span></span><br><span class="line"> Dalvik Other     <span class="number">3692</span>     <span class="number">3692</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1532</span>     <span class="number">1532</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">176</span>      <span class="number">140</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">42884</span>    <span class="number">42884</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev      <span class="number">136</span>        <span class="number">0</span>      <span class="number">136</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">8622</span>      <span class="number">320</span>      <span class="number">836</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">2549</span>        <span class="number">0</span>     <span class="number">2108</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">173</span>        <span class="number">0</span>      <span class="number">128</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">29687</span>       <span class="number">48</span>    <span class="number">23884</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">3646</span>        <span class="number">0</span>     <span class="number">1660</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">2539</span>     <span class="number">1564</span>      <span class="number">792</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1077</span>        <span class="number">8</span>      <span class="number">608</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">36240</span>    <span class="number">36240</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">4924</span>     <span class="number">4924</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">205673</span>   <span class="number">159048</span>    <span class="number">30152</span>        <span class="number">0</span>   <span class="number">110109</span>    <span class="number">87005</span>    <span class="number">23103</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">44836</span></span><br><span class="line">         Native Heap:    <span class="number">25216</span></span><br><span class="line">                Code:    <span class="number">28984</span></span><br><span class="line">               Stack:     <span class="number">1532</span></span><br><span class="line">            Graphics:    <span class="number">79124</span></span><br><span class="line">       Private Other:     <span class="number">9508</span></span><br><span class="line">              System:    <span class="number">16473</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">205673</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="进入AllApps"><a href="#进入AllApps" class="headerlink" title="进入AllApps"></a>进入AllApps</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">16257</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">25539</span>    <span class="number">25512</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">43776</span>    <span class="number">37873</span>     <span class="number">5902</span></span><br><span class="line">  Dalvik Heap    <span class="number">45413</span>    <span class="number">45340</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">66146</span>    <span class="number">57815</span>     <span class="number">8331</span></span><br><span class="line"> Dalvik Other     <span class="number">3960</span>     <span class="number">3960</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1532</span>     <span class="number">1532</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">176</span>      <span class="number">140</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">39380</span>    <span class="number">39380</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev      <span class="number">136</span>        <span class="number">0</span>      <span class="number">136</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">8620</span>      <span class="number">320</span>      <span class="number">836</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">2549</span>        <span class="number">0</span>     <span class="number">2108</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">173</span>        <span class="number">0</span>      <span class="number">128</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">29887</span>       <span class="number">48</span>    <span class="number">24052</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">3646</span>        <span class="number">0</span>     <span class="number">1648</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">2558</span>     <span class="number">1584</span>      <span class="number">792</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1127</span>        <span class="number">8</span>      <span class="number">636</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">44880</span>    <span class="number">44880</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">4924</span>     <span class="number">4924</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">214500</span>   <span class="number">167628</span>    <span class="number">30336</span>        <span class="number">0</span>   <span class="number">109922</span>    <span class="number">95688</span>    <span class="number">14233</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">47716</span></span><br><span class="line">         Native Heap:    <span class="number">25512</span></span><br><span class="line">                Code:    <span class="number">29140</span></span><br><span class="line">               Stack:     <span class="number">1532</span></span><br><span class="line">            Graphics:    <span class="number">84260</span></span><br><span class="line">       Private Other:     <span class="number">9804</span></span><br><span class="line">              System:    <span class="number">16536</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">214500</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="进入天气"><a href="#进入天气" class="headerlink" title="进入天气"></a>进入天气</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">16257</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">30251</span>    <span class="number">30224</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">50176</span>    <span class="number">46472</span>     <span class="number">3703</span></span><br><span class="line">  Dalvik Heap    <span class="number">56889</span>    <span class="number">56816</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">82047</span>    <span class="number">68387</span>    <span class="number">13660</span></span><br><span class="line"> Dalvik Other     <span class="number">4124</span>     <span class="number">4124</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1872</span>     <span class="number">1872</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">228</span>      <span class="number">144</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">48684</span>    <span class="number">48684</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev      <span class="number">136</span>        <span class="number">0</span>      <span class="number">136</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">9119</span>      <span class="number">320</span>     <span class="number">1216</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">2537</span>        <span class="number">0</span>     <span class="number">2096</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">261</span>        <span class="number">0</span>      <span class="number">216</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">31424</span>       <span class="number">48</span>    <span class="number">25576</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">3819</span>        <span class="number">0</span>     <span class="number">1784</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">2593</span>     <span class="number">1620</span>      <span class="number">792</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1397</span>        <span class="number">8</span>      <span class="number">852</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">39552</span>    <span class="number">39552</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">9044</span>     <span class="number">9044</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">241930</span>   <span class="number">192456</span>    <span class="number">32668</span>        <span class="number">0</span>   <span class="number">132223</span>   <span class="number">114859</span>    <span class="number">17363</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">59228</span></span><br><span class="line">         Native Heap:    <span class="number">30224</span></span><br><span class="line">                Code:    <span class="number">31256</span></span><br><span class="line">               Stack:     <span class="number">1872</span></span><br><span class="line">            Graphics:    <span class="number">88236</span></span><br><span class="line">       Private Other:    <span class="number">14308</span></span><br><span class="line">              System:    <span class="number">16806</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">241930</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="进入搜索"><a href="#进入搜索" class="headerlink" title="进入搜索"></a>进入搜索</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">16257</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">30979</span>    <span class="number">30952</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">51712</span>    <span class="number">46697</span>     <span class="number">5014</span></span><br><span class="line">  Dalvik Heap    <span class="number">53559</span>    <span class="number">53488</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">78029</span>    <span class="number">62140</span>    <span class="number">15889</span></span><br><span class="line"> Dalvik Other     <span class="number">4084</span>     <span class="number">4084</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1864</span>     <span class="number">1864</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">224</span>      <span class="number">152</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">44948</span>    <span class="number">44948</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev      <span class="number">136</span>        <span class="number">0</span>      <span class="number">136</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">9092</span>      <span class="number">320</span>     <span class="number">1184</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">1214</span>        <span class="number">0</span>      <span class="number">812</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">224</span>        <span class="number">0</span>      <span class="number">204</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">31530</span>       <span class="number">48</span>    <span class="number">25696</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">4048</span>        <span class="number">0</span>     <span class="number">2056</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">2619</span>     <span class="number">1704</span>      <span class="number">732</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1449</span>        <span class="number">8</span>      <span class="number">812</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">53520</span>    <span class="number">53520</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">8700</span>     <span class="number">8700</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">248190</span>   <span class="number">199788</span>    <span class="number">31632</span>        <span class="number">0</span>   <span class="number">129741</span>   <span class="number">108837</span>    <span class="number">20903</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">55924</span></span><br><span class="line">         Native Heap:    <span class="number">30952</span></span><br><span class="line">                Code:    <span class="number">30320</span></span><br><span class="line">               Stack:     <span class="number">1864</span></span><br><span class="line">            Graphics:    <span class="number">98468</span></span><br><span class="line">       Private Other:    <span class="number">13892</span></span><br><span class="line">              System:    <span class="number">16770</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">248190</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="应用3D主题之后"><a href="#应用3D主题之后" class="headerlink" title="应用3D主题之后"></a>应用3D主题之后</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">23770</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">16450</span>    <span class="number">16424</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">24832</span>    <span class="number">22375</span>     <span class="number">2456</span></span><br><span class="line">  Dalvik Heap    <span class="number">32283</span>    <span class="number">32212</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">57652</span>    <span class="number">46603</span>    <span class="number">11049</span></span><br><span class="line"> Dalvik Other     <span class="number">3352</span>     <span class="number">3352</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack      <span class="number">864</span>      <span class="number">864</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">130</span>      <span class="number">128</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">58872</span>    <span class="number">58872</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev        <span class="number">4</span>        <span class="number">0</span>        <span class="number">4</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">3563</span>      <span class="number">268</span>     <span class="number">1692</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">1359</span>        <span class="number">0</span>      <span class="number">896</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">114</span>        <span class="number">0</span>      <span class="number">112</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">24990</span>       <span class="number">32</span>    <span class="number">20756</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">3203</span>        <span class="number">0</span>     <span class="number">1672</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">1352</span>     <span class="number">1152</span>       <span class="number">16</span>        <span class="number">0</span></span><br><span class="line">   Other mmap      <span class="number">913</span>        <span class="number">8</span>      <span class="number">716</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">44880</span>    <span class="number">44880</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown      <span class="number">300</span>      <span class="number">300</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">192629</span>   <span class="number">158492</span>    <span class="number">25864</span>        <span class="number">0</span>    <span class="number">82484</span>    <span class="number">68978</span>    <span class="number">13505</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">33380</span></span><br><span class="line">         Native Heap:    <span class="number">16424</span></span><br><span class="line">                Code:    <span class="number">25428</span></span><br><span class="line">               Stack:      <span class="number">864</span></span><br><span class="line">            Graphics:   <span class="number">103752</span></span><br><span class="line">       Private Other:     <span class="number">4508</span></span><br><span class="line">              System:     <span class="number">8273</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">192629</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="3D桌面——关屏"><a href="#3D桌面——关屏" class="headerlink" title="3D桌面——关屏"></a>3D桌面——关屏</h3><blockquote>
<p>静置1min</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">23770</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">20416</span>    <span class="number">20388</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">33280</span>    <span class="number">27504</span>     <span class="number">5775</span></span><br><span class="line">  Dalvik Heap    <span class="number">34972</span>    <span class="number">34900</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">60660</span>    <span class="number">44452</span>    <span class="number">16208</span></span><br><span class="line"> Dalvik Other     <span class="number">3228</span>     <span class="number">3228</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1088</span>     <span class="number">1088</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">150</span>      <span class="number">136</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">59148</span>    <span class="number">59148</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev        <span class="number">8</span>        <span class="number">0</span>        <span class="number">8</span>        <span class="number">0</span></span><br><span class="line">     .so mmap    <span class="number">12463</span>      <span class="number">284</span>     <span class="number">9176</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap     <span class="number">2967</span>        <span class="number">0</span>     <span class="number">2524</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">110</span>        <span class="number">0</span>      <span class="number">108</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">31520</span>       <span class="number">52</span>    <span class="number">26864</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">3170</span>        <span class="number">0</span>     <span class="number">1560</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">1701</span>     <span class="number">1348</span>       <span class="number">20</span>        <span class="number">0</span></span><br><span class="line">   Other mmap     <span class="number">1359</span>        <span class="number">8</span>     <span class="number">1120</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">44880</span>    <span class="number">44880</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">3652</span>     <span class="number">3652</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">220832</span>   <span class="number">169112</span>    <span class="number">41380</span>        <span class="number">0</span>    <span class="number">93940</span>    <span class="number">71956</span>    <span class="number">21983</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">36268</span></span><br><span class="line">         Native Heap:    <span class="number">20388</span></span><br><span class="line">                Code:    <span class="number">40568</span></span><br><span class="line">               Stack:     <span class="number">1088</span></span><br><span class="line">            Graphics:   <span class="number">104028</span></span><br><span class="line">       Private Other:     <span class="number">8152</span></span><br><span class="line">              System:    <span class="number">10340</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">220832</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>
<h3 id="从3D切回2D"><a href="#从3D切回2D" class="headerlink" title="从3D切回2D"></a>从3D切回2D</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">** MEMINFO in pid <span class="number">23770</span> [com.org.test] **</span><br><span class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span><br><span class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span><br><span class="line">                ------   ------   ------   ------   ------   ------   ------</span><br><span class="line">  Native Heap    <span class="number">23624</span>    <span class="number">23596</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">37376</span>    <span class="number">31068</span>     <span class="number">6307</span></span><br><span class="line">  Dalvik Heap    <span class="number">48127</span>    <span class="number">48056</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">69274</span>    <span class="number">53190</span>    <span class="number">16084</span></span><br><span class="line"> Dalvik Other     <span class="number">3368</span>     <span class="number">3368</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        Stack     <span class="number">1256</span>     <span class="number">1256</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">       Ashmem      <span class="number">150</span>      <span class="number">136</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Gfx dev    <span class="number">70896</span>    <span class="number">70896</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">    Other dev        <span class="number">8</span>        <span class="number">0</span>        <span class="number">8</span>        <span class="number">0</span></span><br><span class="line">     .so mmap     <span class="number">4425</span>      <span class="number">320</span>      <span class="number">968</span>        <span class="number">0</span></span><br><span class="line">    .apk mmap      <span class="number">654</span>        <span class="number">0</span>       <span class="number">64</span>        <span class="number">0</span></span><br><span class="line">    .ttf mmap      <span class="number">118</span>        <span class="number">0</span>      <span class="number">108</span>        <span class="number">0</span></span><br><span class="line">    .dex mmap    <span class="number">13328</span>       <span class="number">52</span>     <span class="number">8816</span>        <span class="number">0</span></span><br><span class="line">    .oat mmap     <span class="number">1996</span>        <span class="number">0</span>      <span class="number">380</span>        <span class="number">0</span></span><br><span class="line">    .art mmap     <span class="number">2020</span>     <span class="number">1440</span>      <span class="number">332</span>        <span class="number">0</span></span><br><span class="line">   Other mmap       <span class="number">88</span>        <span class="number">8</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">   EGL mtrack    <span class="number">53520</span>    <span class="number">53520</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">      Unknown     <span class="number">3668</span>     <span class="number">3668</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">        TOTAL   <span class="number">227246</span>   <span class="number">206316</span>    <span class="number">10676</span>        <span class="number">0</span>   <span class="number">106650</span>    <span class="number">84258</span>    <span class="number">22391</span></span><br><span class="line"></span><br><span class="line"> App Summary</span><br><span class="line">                       Pss(KB)</span><br><span class="line">                        ------</span><br><span class="line">           Java Heap:    <span class="number">49828</span></span><br><span class="line">         Native Heap:    <span class="number">23596</span></span><br><span class="line">                Code:    <span class="number">10708</span></span><br><span class="line">               Stack:     <span class="number">1256</span></span><br><span class="line">            Graphics:   <span class="number">124416</span></span><br><span class="line">       Private Other:     <span class="number">7188</span></span><br><span class="line">              System:    <span class="number">10254</span></span><br><span class="line"></span><br><span class="line">               TOTAL:   <span class="number">227246</span>      <span class="function">TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">------------------------              </span></span><br><span class="line"><span class="function">After 5Min------------------              </span></span><br><span class="line"><span class="function">------------------------              </span></span><br><span class="line"><span class="function">** MEMINFO in pid 23770 [com.org.test] **</span></span><br><span class="line"><span class="function">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</span></span><br><span class="line"><span class="function">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</span></span><br><span class="line"><span class="function">                ------   ------   ------   ------   ------   ------   ------</span></span><br><span class="line"><span class="function">  Native Heap    23368    23340        0        0    37120    30598     6521</span></span><br><span class="line"><span class="function">  Dalvik Heap    43928    43856        0        0    69379    65551     3828</span></span><br><span class="line"><span class="function"> Dalvik Other     3560     3560        0        0</span></span><br><span class="line"><span class="function">        Stack     1244     1244        0        0</span></span><br><span class="line"><span class="function">       Ashmem      150      136        0        0</span></span><br><span class="line"><span class="function">      Gfx dev    72440    72440        0        0</span></span><br><span class="line"><span class="function">    Other dev        8        0        8        0</span></span><br><span class="line"><span class="function">     .so mmap     3636      320      788        0</span></span><br><span class="line"><span class="function">    .apk mmap      395        0        0        0</span></span><br><span class="line"><span class="function">    .ttf mmap       26        0        8        0</span></span><br><span class="line"><span class="function">    .dex mmap    12470       52     8176        0</span></span><br><span class="line"><span class="function">    .oat mmap     2610        0      260        0</span></span><br><span class="line"><span class="function">    .art mmap     2159     1456       28        0</span></span><br><span class="line"><span class="function">   Other mmap       58        8       20        0</span></span><br><span class="line"><span class="function">   EGL mtrack    44880    44880        0        0</span></span><br><span class="line"><span class="function">      Unknown     3668     3668        0        0</span></span><br><span class="line"><span class="function">        TOTAL   214600   194960     9288        0   106499    96149    10349</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> App Summary</span></span><br><span class="line"><span class="function">                       <span class="title">Pss</span><span class="params">(KB)</span></span></span><br><span class="line"><span class="function">                        ------</span></span><br><span class="line"><span class="function">           Java Heap:    45340</span></span><br><span class="line"><span class="function">         Native Heap:    23340</span></span><br><span class="line"><span class="function">                Code:     9604</span></span><br><span class="line"><span class="function">               Stack:     1244</span></span><br><span class="line"><span class="function">            Graphics:   117320</span></span><br><span class="line"><span class="function">       Private Other:     7400</span></span><br><span class="line"><span class="function">              System:    10352</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">               TOTAL:   214600      TOTAL <span class="title">SWAP</span> <span class="params">(KB)</span>:        0</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GL/">GL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Performance/">Performance</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-技术/Android/GL check point"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/技术/Android/GL check point/">GL check point</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/技术/Android/GL check point/" class="article-date">
	  <time datetime="2018-03-08T16:35:35.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
    <a class="article-category-link" href="/categories/技术/">技术</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="调查点："><a href="#调查点：" class="headerlink" title="调查点："></a>调查点：</h2><ol>
<li><p>纹理是否压缩</p>
<ul>
<li>疑问：不同GPU支持的纹理格式不一样，需要对GPU做适配，工作量不小</li>
</ul>
<blockquote>
<p>志文：壁纸或许可以做一些处理（go-org反编译代码未发现类似处理），理想情况下，可以减7-8M内存占用</p>
</blockquote>
</li>
<li><p>Mipmap</p>
<blockquote>
<p>虽然Mipmap包会比原始图像多用掉33%的内存，但它不仅可以提升性能，也会提高图像质量</p>
<blockquote>
<p>ARM Mali GPU Texture Compression Tool可以生成Mipmap</p>
</blockquote>
</blockquote>
<ul>
<li>结论：这个功能会更耗内存，适用于游戏场景，org不适用</li>
</ul>
</li>
<li><p>纹理参数设置</p>
<blockquote>
<p>基本越慢的函数，视觉质量越高</p>
<p>参数配置参考链接：<a href="https://www.khronos.org/registry/OpenGL-Refpages/es2.0/" target="_blank" rel="noopener">https://www.khronos.org/registry/OpenGL-Refpages/es2.0/</a></p>
</blockquote>
</li>
<li><p>RenderScript 3D 渲染</p>
</li>
</ol>
<p>高斯模糊之类的优化</p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GL/">GL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Performance/">Performance</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; 上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/5/">下一页 &raquo;</a>
  </nav>

</section>
        
      </div>
      
        <div align="center" style="margin-top: 30px;"><hr class="hr" style="margin:0px; height:3px;"></div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="/about/" target="_blank">KyleCe</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2015 - 2018 KyleCe All Rights Reserved.</p>

	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>


  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>


  <script src="/js/home.js"></script>










	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            KyleCe
          </div>
          <div class="panel-body">
            Copyright © 2018 KyleCe All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
</body>
</html>